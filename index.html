<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEON MEMORIES ‚Ä¢ Retro Photo Editor</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=VT323&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-pink: #ff2a6d;
            --neon-blue: #05d9e8;
            --neon-purple: #d300c5;
            --neon-yellow: #ffe66d;
            --dark-bg: #0d0221;
            --dark-surface: #1a0a2e;
            --dark-card: #16082a;
            --accent-gradient: linear-gradient(135deg, #ff2a6d, #d300c5, #05d9e8);
        }
        
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--neon-pink) var(--dark-surface);
        }
        
        *::-webkit-scrollbar {
            width: 6px;
        }
        
        *::-webkit-scrollbar-track {
            background: var(--dark-surface);
        }
        
        *::-webkit-scrollbar-thumb {
            background: var(--neon-pink);
            border-radius: 3px;
        }
        
        body {
            font-family: 'Orbitron', sans-serif;
            background: var(--dark-bg);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .vhs-font {
            font-family: 'VT323', monospace;
        }
        
        .pixel-font {
            font-family: 'Press Start 2P', cursive;
        }
        
        /* Animated background */
        .bg-grid {
            position: fixed;
            inset: 0;
            background: 
                linear-gradient(180deg, rgba(13, 2, 33, 0.95) 0%, rgba(13, 2, 33, 0.7) 50%, rgba(13, 2, 33, 0.9) 100%),
                repeating-linear-gradient(90deg, transparent 0, rgba(5, 217, 232, 0.03) 1px, transparent 1px, transparent 80px),
                repeating-linear-gradient(0deg, transparent 0, rgba(255, 42, 109, 0.03) 1px, transparent 1px, transparent 80px);
            z-index: -2;
        }
        
        .retro-sun {
            position: fixed;
            bottom: -150px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            height: 500px;
            background: linear-gradient(180deg, #ffe66d 0%, #ff9e2a 20%, #ff2a6d 50%, #d300c5 75%, #4a0080 100%);
            border-radius: 50%;
            z-index: -1;
            opacity: 0.4;
            filter: blur(2px);
        }
        
        .retro-sun::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent 0px,
                transparent 10px,
                rgba(13, 2, 33, 0.8) 10px,
                rgba(13, 2, 33, 0.8) 15px
            );
            border-radius: 50%;
        }
        
        .perspective-grid {
            position: fixed;
            bottom: 0;
            left: -50%;
            right: -50%;
            height: 40vh;
            background: 
                repeating-linear-gradient(90deg, rgba(5, 217, 232, 0.15) 0, rgba(5, 217, 232, 0.15) 1px, transparent 1px, transparent 60px),
                repeating-linear-gradient(180deg, rgba(255, 42, 109, 0.1) 0, rgba(255, 42, 109, 0.1) 1px, transparent 1px, transparent 40px);
            transform: perspective(500px) rotateX(65deg);
            transform-origin: center top;
            z-index: -1;
            animation: gridMove 20s linear infinite;
        }
        
        @keyframes gridMove {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 0 0, 0 400px; }
        }
        
        /* Neon glow effects */
        .neon-text-pink {
            text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink), 0 0 40px var(--neon-pink);
        }
        
        .neon-text-blue {
            text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
        }
        
        .neon-border {
            border: 1px solid var(--neon-pink);
            box-shadow: 0 0 10px rgba(255, 42, 109, 0.3), inset 0 0 20px rgba(5, 217, 232, 0.05);
        }
        
        .neon-border-blue {
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 10px rgba(5, 217, 232, 0.3), inset 0 0 20px rgba(5, 217, 232, 0.05);
        }
        
        /* Cards and panels */
        .glass-panel {
            background: linear-gradient(135deg, rgba(26, 10, 46, 0.9) 0%, rgba(22, 8, 42, 0.95) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 42, 109, 0.2);
            border-radius: 12px;
        }
        
        .tool-section {
            background: rgba(13, 2, 33, 0.6);
            border: 1px solid rgba(5, 217, 232, 0.15);
            border-radius: 8px;
        }
        
        /* Buttons */
        .btn-neon {
            background: linear-gradient(135deg, rgba(255, 42, 109, 0.2) 0%, rgba(211, 0, 197, 0.2) 100%);
            border: 1px solid var(--neon-pink);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-family: 'VT323', monospace;
            font-size: 16px;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-neon:hover {
            background: linear-gradient(135deg, rgba(255, 42, 109, 0.4) 0%, rgba(211, 0, 197, 0.4) 100%);
            box-shadow: 0 0 20px rgba(255, 42, 109, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-neon.active {
            background: linear-gradient(135deg, var(--neon-pink) 0%, var(--neon-purple) 100%);
            box-shadow: 0 0 20px rgba(255, 42, 109, 0.7);
        }
        
        .btn-icon {
            background: rgba(5, 217, 232, 0.1);
            border: 1px solid rgba(5, 217, 232, 0.3);
            color: var(--neon-blue);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 18px;
        }
        
        .btn-icon:hover {
            background: rgba(5, 217, 232, 0.2);
            box-shadow: 0 0 15px rgba(5, 217, 232, 0.4);
            transform: scale(1.1);
        }
        
        .btn-icon.active {
            background: var(--neon-blue);
            color: var(--dark-bg);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--neon-pink) 0%, var(--neon-purple) 100%);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            letter-spacing: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 42, 109, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 42, 109, 0.6);
        }
        
        /* Sliders */
        .slider-wrapper {
            position: relative;
        }
        
        .slider-wrapper input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--dark-surface) 0%, var(--dark-surface) 100%);
            border-radius: 3px;
            outline: none;
            border: 1px solid rgba(5, 217, 232, 0.2);
        }
        
        .slider-wrapper input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-pink));
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--neon-blue);
            transition: all 0.2s ease;
        }
        
        .slider-wrapper input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px var(--neon-blue);
        }
        
        /* Canvas area */
        .canvas-wrapper {
            background: 
                linear-gradient(45deg, rgba(13, 2, 33, 0.8) 25%, transparent 25%),
                linear-gradient(-45deg, rgba(13, 2, 33, 0.8) 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, rgba(13, 2, 33, 0.8) 75%),
                linear-gradient(-45deg, transparent 75%, rgba(13, 2, 33, 0.8) 75%);
            background-size: 16px 16px;
            background-position: 0 0, 0 8px, 8px -8px, -8px 0px;
            background-color: #0a0118;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        
        /* Tabs */
        .tab-btn {
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-family: 'VT323', monospace;
            font-size: 18px;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-btn:hover {
            color: var(--neon-blue);
        }
        
        .tab-btn.active {
            color: var(--neon-pink);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--neon-pink);
            box-shadow: 0 0 10px var(--neon-pink);
        }
        
        /* Effect cards */
        .effect-card {
            background: rgba(13, 2, 33, 0.6);
            border: 1px solid rgba(255, 42, 109, 0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .effect-card:hover {
            border-color: var(--neon-pink);
            box-shadow: 0 0 20px rgba(255, 42, 109, 0.3);
            transform: translateY(-3px);
        }
        
        .effect-card.active {
            border-color: var(--neon-blue);
            background: rgba(5, 217, 232, 0.1);
            box-shadow: 0 0 20px rgba(5, 217, 232, 0.4);
        }
        
        /* Scanline effect */
        .scanlines::after {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
        }
        
        /* VHS timestamp style */
        .vhs-display {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 230, 109, 0.3);
            padding: 4px 12px;
            font-family: 'VT323', monospace;
            color: var(--neon-yellow);
            text-shadow: 0 0 5px var(--neon-yellow);
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
        }
        
        .tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 12px;
            background: var(--dark-surface);
            border: 1px solid var(--neon-pink);
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .tooltip:hover::before {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 8px);
        }
        
        /* Animations */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 42, 109, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 42, 109, 0.8); }
        }
        
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            92% { opacity: 1; }
            93% { opacity: 0.8; }
            94% { opacity: 1; }
            95% { opacity: 0.9; }
        }
        
        .flicker {
            animation: flicker 3s infinite;
        }
        
        /* Hide scrollbar for tab container */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* Upload area */
        .upload-zone {
            border: 2px dashed rgba(5, 217, 232, 0.4);
            border-radius: 16px;
            background: rgba(5, 217, 232, 0.02);
            transition: all 0.3s ease;
        }
        
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--neon-pink);
            background: rgba(255, 42, 109, 0.05);
            box-shadow: 0 0 30px rgba(255, 42, 109, 0.2);
        }
        
        /* History buttons */
        .history-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .history-btn:hover:not(:disabled) {
            background: rgba(5, 217, 232, 0.1);
            border-color: var(--neon-blue);
            color: var(--neon-blue);
        }
        
        .history-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Color picker wrapper */
        .color-picker-wrapper {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--neon-blue);
        }
        
        .color-picker-wrapper input[type="color"] {
            position: absolute;
            inset: -10px;
            width: calc(100% + 20px);
            height: calc(100% + 20px);
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body class="text-white min-h-screen">
    <!-- Background elements -->
    <div class="bg-grid"></div>
    <div class="retro-sun"></div>
    <div class="perspective-grid"></div>
    
    <!-- Header -->
    <header class="relative z-10 px-6 py-4 border-b border-pink-500/20">
        <div class="max-w-screen-2xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="text-3xl">üìº</div>
                <div>
                    <h1 class="text-2xl font-black text-pink-400 neon-text-pink tracking-wider flicker">NEON MEMORIES</h1>
                    <p class="vhs-font text-sm text-cyan-400 opacity-80">RETRO PHOTO EDITOR ‚Ä¢ EST. 1985</p>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="vhs-display hidden sm:block">
                    <span id="timestamp">JAN 01 1989 00:00:00</span>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="undo()" id="undoBtn" class="history-btn vhs-font" disabled data-tooltip="Undo">
                        ‚Ü∂ UNDO
                    </button>
                    <button onclick="redo()" id="redoBtn" class="history-btn vhs-font" disabled data-tooltip="Redo">
                        REDO ‚Ü∑
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="relative z-10 max-w-screen-2xl mx-auto p-4 lg:p-6">
        <div class="grid lg:grid-cols-12 gap-4 lg:gap-6">
            
            <!-- Left Sidebar - Tools -->
            <aside class="lg:col-span-3 xl:col-span-2 order-2 lg:order-1">
                <div class="glass-panel p-4 space-y-4 sticky top-4">
                    <h2 class="vhs-font text-xl text-cyan-400 neon-text-blue flex items-center gap-2">
                        <span>üîß</span> TOOLS
                    </h2>
                    
                    <!-- Transform Tools -->
                    <div class="tool-section p-3">
                        <h3 class="vhs-font text-sm text-pink-400 mb-3">TRANSFORM</h3>
                        <div class="grid grid-cols-4 gap-2">
                            <button onclick="rotateImage(-90)" class="btn-icon tooltip" data-tooltip="Rotate Left">‚Ü∫</button>
                            <button onclick="rotateImage(90)" class="btn-icon tooltip" data-tooltip="Rotate Right">‚Üª</button>
                            <button onclick="flipImage('h')" class="btn-icon tooltip" data-tooltip="Flip Horizontal">‚áÜ</button>
                            <button onclick="flipImage('v')" class="btn-icon tooltip" data-tooltip="Flip Vertical">‚áÖ</button>
                        </div>
                    </div>
                    
                    <!-- Crop & Resize -->
                    <div class="tool-section p-3">
                        <h3 class="vhs-font text-sm text-pink-400 mb-3">CROP & RESIZE</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="setCropRatio('free')" class="btn-neon text-xs" id="cropFree">FREE</button>
                            <button onclick="setCropRatio('1:1')" class="btn-neon text-xs">1:1</button>
                            <button onclick="setCropRatio('4:3')" class="btn-neon text-xs">4:3</button>
                            <button onclick="setCropRatio('16:9')" class="btn-neon text-xs">16:9</button>
                        </div>
                        <button onclick="toggleCrop()" class="btn-neon w-full mt-2" id="cropBtn">‚úÇÔ∏è CROP MODE</button>
                    </div>
                    
                    <!-- Drawing Tools -->
                    <div class="tool-section p-3">
                        <h3 class="vhs-font text-sm text-pink-400 mb-3">DRAW</h3>
                        <div class="flex items-center gap-2 mb-2">
                            <button onclick="setTool('brush')" class="btn-icon tooltip flex-1" data-tooltip="Brush" id="brushTool">üñåÔ∏è</button>
                            <button onclick="setTool('eraser')" class="btn-icon tooltip flex-1" data-tooltip="Eraser" id="eraserTool">üßπ</button>
                            <div class="color-picker-wrapper">
                                <input type="color" id="brushColor" value="#ff2a6d" onchange="updateBrushColor()">
                            </div>
                        </div>
                        <div class="slider-wrapper">
                            <label class="vhs-font text-xs text-gray-400">BRUSH SIZE</label>
                            <input type="range" id="brushSize" min="1" max="50" value="5">
                        </div>
                    </div>
                    
                    <!-- Text Tool -->
                    <div class="tool-section p-3">
                        <h3 class="vhs-font text-sm text-pink-400 mb-3">TEXT</h3>
                        <input type="text" id="textInput" placeholder="Enter text..." 
                            class="w-full bg-black/50 border border-cyan-500/30 rounded px-3 py-2 text-sm mb-2 focus:border-pink-500 focus:outline-none">
                        <div class="flex gap-2 mb-2">
                            <select id="textFont" class="flex-1 bg-black/50 border border-cyan-500/30 rounded px-2 py-1 text-xs">
                                <option value="VT323">VHS</option>
                                <option value="Orbitron">RETRO</option>
                                <option value="Press Start 2P">PIXEL</option>
                            </select>
                            <input type="number" id="textSize" value="32" min="8" max="120" 
                                class="w-16 bg-black/50 border border-cyan-500/30 rounded px-2 py-1 text-xs">
                        </div>
                        <button onclick="addText()" class="btn-neon w-full">ADD TEXT</button>
                    </div>
                </div>
            </aside>
            
            <!-- Center - Canvas -->
            <section class="lg:col-span-6 xl:col-span-7 order-1 lg:order-2">
                <div class="glass-panel p-4">
                    <!-- Toolbar -->
                    <div class="flex items-center justify-between mb-4 flex-wrap gap-2">
                        <div class="flex items-center gap-2">
                            <button onclick="zoomCanvas(-0.1)" class="btn-icon text-sm">‚àí</button>
                            <span class="vhs-font text-cyan-400 min-w-[60px] text-center" id="zoomLevel">100%</span>
                            <button onclick="zoomCanvas(0.1)" class="btn-icon text-sm">+</button>
                            <button onclick="resetZoom()" class="btn-icon text-sm">‚ü≤</button>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="document.getElementById('fileInput').click()" class="btn-primary text-sm">
                                üìÅ LOAD IMAGE
                            </button>
                            <input type="file" id="fileInput" accept="image/*" class="hidden">
                        </div>
                    </div>
                    
                    <!-- Canvas Container -->
                    <div class="canvas-wrapper scanlines relative min-h-[400px] lg:min-h-[500px] flex items-center justify-center" 
                         id="canvasContainer">
                        <canvas id="photoCanvas" class="max-w-full hidden cursor-crosshair"></canvas>
                        
                        <!-- Upload Prompt -->
                        <div id="uploadPrompt" class="upload-zone absolute inset-4 flex flex-col items-center justify-center">
                            <div class="text-6xl mb-4 animate-bounce">üì∏</div>
                            <p class="vhs-font text-2xl text-cyan-400 mb-2">DROP YOUR PHOTO HERE</p>
                            <p class="vhs-font text-lg text-pink-400">or click LOAD IMAGE above</p>
                            <div class="mt-6 flex gap-4 vhs-font text-sm text-gray-500">
                                <span>JPG</span>
                                <span>‚Ä¢</span>
                                <span>PNG</span>
                                <span>‚Ä¢</span>
                                <span>GIF</span>
                                <span>‚Ä¢</span>
                                <span>WEBP</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bottom Actions -->
                    <div class="flex items-center justify-between mt-4 flex-wrap gap-4">
                        <div class="flex items-center gap-2 vhs-font text-sm text-gray-400">
                            <span id="imageInfo">No image loaded</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="resetImage()" class="btn-neon">‚Ü∫ RESET</button>
                            <button onclick="downloadImage('png')" class="btn-primary">üíæ SAVE PNG</button>
                            <button onclick="downloadImage('jpg')" class="btn-neon">SAVE JPG</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Right Sidebar - Effects & Adjustments -->
            <aside class="lg:col-span-3 order-3">
                <div class="glass-panel p-4 sticky top-4">
                    <!-- Tabs -->
                    <div class="flex border-b border-pink-500/20 mb-4 overflow-x-auto hide-scrollbar">
                        <button onclick="switchTab('adjust')" class="tab-btn active" id="tabAdjust">ADJUST</button>
                        <button onclick="switchTab('effects')" class="tab-btn" id="tabEffects">EFFECTS</button>
                        <button onclick="switchTab('vintage')" class="tab-btn" id="tabVintage">VINTAGE</button>
                        <button onclick="switchTab('frames')" class="tab-btn" id="tabFrames">FRAMES</button>
                    </div>
                    
                    <!-- Adjust Panel -->
                    <div id="panelAdjust" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">BRIGHTNESS</label>
                                <span class="vhs-font text-xs text-cyan-400" id="brightnessVal">0</span>
                            </div>
                            <input type="range" id="brightness" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">CONTRAST</label>
                                <span class="vhs-font text-xs text-cyan-400" id="contrastVal">0</span>
                            </div>
                            <input type="range" id="contrast" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">SATURATION</label>
                                <span class="vhs-font text-xs text-cyan-400" id="saturationVal">0</span>
                            </div>
                            <input type="range" id="saturation" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">EXPOSURE</label>
                                <span class="vhs-font text-xs text-cyan-400" id="exposureVal">0</span>
                            </div>
                            <input type="range" id="exposure" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">TEMPERATURE</label>
                                <span class="vhs-font text-xs text-cyan-400" id="temperatureVal">0</span>
                            </div>
                            <input type="range" id="temperature" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">TINT</label>
                                <span class="vhs-font text-xs text-cyan-400" id="tintVal">0</span>
                            </div>
                            <input type="range" id="tint" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">SHADOWS</label>
                                <span class="vhs-font text-xs text-cyan-400" id="shadowsVal">0</span>
                            </div>
                            <input type="range" id="shadows" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">HIGHLIGHTS</label>
                                <span class="vhs-font text-xs text-cyan-400" id="highlightsVal">0</span>
                            </div>
                            <input type="range" id="highlights" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">SHARPNESS</label>
                                <span class="vhs-font text-xs text-cyan-400" id="sharpnessVal">0</span>
                            </div>
                            <input type="range" id="sharpness" min="0" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">VIGNETTE</label>
                                <span class="vhs-font text-xs text-cyan-400" id="vignetteVal">0</span>
                            </div>
                            <input type="range" id="vignette" min="0" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">BLUR</label>
                                <span class="vhs-font text-xs text-cyan-400" id="blurVal">0</span>
                            </div>
                            <input type="range" id="blur" min="0" max="20" value="0" step="0.5" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">HUE ROTATE</label>
                                <span class="vhs-font text-xs text-cyan-400" id="hueVal">0¬∞</span>
                            </div>
                            <input type="range" id="hue" min="0" max="360" value="0" oninput="updateAdjustments()">
                        </div>
                    </div>
                    
                    <!-- Effects Panel -->
                    <div id="panelEffects" class="hidden grid grid-cols-2 gap-2 max-h-[60vh] overflow-y-auto pr-2">
                        <div class="effect-card" onclick="applyEffect('vhs')">
                            <div class="text-2xl mb-1">üìº</div>
                            <div class="vhs-font text-sm">VHS</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('glitch')">
                            <div class="text-2xl mb-1">üëæ</div>
                            <div class="vhs-font text-sm">GLITCH</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('scanlines')">
                            <div class="text-2xl mb-1">üì∫</div>
                            <div class="vhs-font text-sm">SCANLINES</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('chromatic')">
                            <div class="text-2xl mb-1">üåà</div>
                            <div class="vhs-font text-sm">RGB SPLIT</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('pixelate')">
                            <div class="text-2xl mb-1">üéÆ</div>
                            <div class="vhs-font text-sm">8-BIT</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('neon')">
                            <div class="text-2xl mb-1">üíú</div>
                            <div class="vhs-font text-sm">NEON GLOW</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('cyberpunk')">
                            <div class="text-2xl mb-1">üåÉ</div>
                            <div class="vhs-font text-sm">CYBERPUNK</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('synthwave')">
                            <div class="text-2xl mb-1">üåÖ</div>
                            <div class="vhs-font text-sm">SYNTHWAVE</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('vaporwave')">
                            <div class="text-2xl mb-1">üå¥</div>
                            <div class="vhs-font text-sm">VAPORWAVE</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('miami')">
                            <div class="text-2xl mb-1">üèñÔ∏è</div>
                            <div class="vhs-font text-sm">MIAMI</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('tokyo')">
                            <div class="text-2xl mb-1">üóº</div>
                            <div class="vhs-font text-sm">TOKYO</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('arcade')">
                            <div class="text-2xl mb-1">üïπÔ∏è</div>
                            <div class="vhs-font text-sm">ARCADE</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('duotone')">
                            <div class="text-2xl mb-1">üé®</div>
                            <div class="vhs-font text-sm">DUOTONE</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('noir')">
                            <div class="text-2xl mb-1">üé¨</div>
                            <div class="vhs-font text-sm">NOIR</div>
                        </div>
                    </div>
                    
                    <!-- Vintage Panel -->
                    <div id="panelVintage" class="hidden grid grid-cols-2 gap-2 max-h-[60vh] overflow-y-auto pr-2">
                        <div class="effect-card" onclick="applyVintage('sepia')">
                            <div class="text-2xl mb-1">üü§</div>
                            <div class="vhs-font text-sm">SEPIA</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('faded')">
                            <div class="text-2xl mb-1">üå´Ô∏è</div>
                            <div class="vhs-font text-sm">FADED</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('polaroid')">
                            <div class="text-2xl mb-1">üì∑</div>
                            <div class="vhs-font text-sm">POLAROID</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('kodak')">
                            <div class="text-2xl mb-1">üéûÔ∏è</div>
                            <div class="vhs-font text-sm">KODAK</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('fuji')">
                            <div class="text-2xl mb-1">üì∏</div>
                            <div class="vhs-font text-sm">FUJI</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('agfa')">
                            <div class="text-2xl mb-1">üé•</div>
                            <div class="vhs-font text-sm">AGFA</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('grain')">
                            <div class="text-2xl mb-1">‚ú®</div>
                            <div class="vhs-font text-sm">FILM GRAIN</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('dusty')">
                            <div class="text-2xl mb-1">üí®</div>
                            <div class="vhs-font text-sm">DUSTY</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('lightleak')">
                            <div class="text-2xl mb-1">‚òÄÔ∏è</div>
                            <div class="vhs-font text-sm">LIGHT LEAK</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('oldphoto')">
                            <div class="text-2xl mb-1">üñºÔ∏è</div>
                            <div class="vhs-font text-sm">OLD PHOTO</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('1970s')">
                            <div class="text-2xl mb-1">üï∫</div>
                            <div class="vhs-font text-sm">1970s</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('1980s')">
                            <div class="text-2xl mb-1">üíø</div>
                            <div class="vhs-font text-sm">1980s</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('1990s')">
                            <div class="text-2xl mb-1">üíæ</div>
                            <div class="vhs-font text-sm">1990s</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('daguerreotype')">
                            <div class="text-2xl mb-1">üèõÔ∏è</div>
                            <div class="vhs-font text-sm">ANTIQUE</div>
                        </div>
                    </div>
                    
                    <!-- Frames Panel -->
                    <div id="panelFrames" class="hidden space-y-3 max-h-[60vh] overflow-y-auto pr-2">
                        <div class="grid grid-cols-2 gap-2">
                            <div class="effect-card" onclick="applyFrame('vhsFrame')">
                                <div class="text-2xl mb-1">üìº</div>
                                <div class="vhs-font text-sm">VHS FRAME</div>
                            </div>
                            <div class="effect-card" onclick="applyFrame('polaroidFrame')">
                                <div class="text-2xl mb-1">üñºÔ∏è</div>
                                <div class="vhs-font text-sm">POLAROID</div>
                            </div>
                            <div class="effect-card" onclick="applyFrame('retroTV')">
                                <div class="text-2xl mb-1">üì∫</div>
                                <div class="vhs-font text-sm">RETRO TV</div>
                            </div>
                            <div class="effect-card" onclick="applyFrame('arcade')">
                                <div class="text-2xl mb-1">üïπÔ∏è</div>
                                <div class="vhs-font text-sm">ARCADE</div>
                            </div>
                            <div class="effect-card" onclick="applyFrame('neonBorder')">
                                <div class="text-2xl mb-1">üí†</div>
                                <div class="vhs-font text-sm">NEON</div>
                            </div>
                            <div class="effect-card" onclick="applyFrame('none')">
                                <div class="text-2xl mb-1">‚ùå</div>
                                <div class="vhs-font text-sm">NO FRAME</div>
                            </div>
                        </div>
                        
                        <div class="tool-section p-3">
                            <h3 class="vhs-font text-sm text-pink-400 mb-3">OVERLAYS</h3>
                            <div class="space-y-2">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="overlayTimestamp" onchange="toggleOverlay('timestamp')" class="accent-pink-500">
                                    <span class="vhs-font text-sm">üìÖ TIMESTAMP</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="overlayRec" onchange="toggleOverlay('rec')" class="accent-pink-500">
                                    <span class="vhs-font text-sm">üî¥ REC</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="overlayPlay" onchange="toggleOverlay('play')" class="accent-pink-500">
                                    <span class="vhs-font text-sm">‚ñ∂ PLAY</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="overlayTracking" onchange="toggleOverlay('tracking')" class="accent-pink-500">
                                    <span class="vhs-font text-sm">üì∂ TRACKING</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>
    
    <script>
        // Main variables
        const canvas = document.getElementById('photoCanvas');
        const ctx = canvas.getContext('2d');
        const fileInput = document.getElementById('fileInput');
        const uploadPrompt = document.getElementById('uploadPrompt');
        const canvasContainer = document.getElementById('canvasContainer');
        
        let originalImage = null;
        let currentImageData = null;
        let zoom = 1;
        let history = [];
        let historyIndex = -1;
        let currentTool = null;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let overlays = { timestamp: false, rec: false, play: false, tracking: false };
        let currentFrame = 'none';
        let isCropping = false;
        let cropRatio = 'free';
        
        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
            const year = 1985 + Math.floor(Math.random() * 10);
            const text = `${months[now.getMonth()]} ${String(now.getDate()).padStart(2, '0')} ${year} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
            document.getElementById('timestamp').textContent = text;
        }
        setInterval(updateTimestamp, 1000);
        updateTimestamp();
        
        // File handling
        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) loadImage(e.target.files[0]);
        });
        
        // Drag and drop
        canvasContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadPrompt.classList.add('dragover');
        });
        
        canvasContainer.addEventListener('dragleave', () => {
            uploadPrompt.classList.remove('dragover');
        });
        
        canvasContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadPrompt.classList.remove('dragover');
            if (e.dataTransfer.files[0]) loadImage(e.dataTransfer.files[0]);
        });
        
        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    originalImage = img;
                    
                    const maxWidth = 900;
                    const maxHeight = 600;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth) {
                        height = (maxWidth / width) * height;
                        width = maxWidth;
                    }
                    if (height > maxHeight) {
                        width = (maxHeight / height) * width;
                        height = maxHeight;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    canvas.classList.remove('hidden');
                    uploadPrompt.classList.add('hidden');
                    
                    document.getElementById('imageInfo').textContent = `${Math.round(width)} √ó ${Math.round(height)} px`;
                    
                    saveToHistory();
                    resetAdjustments();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // History management
        function saveToHistory() {
            historyIndex++;
            history = history.slice(0, historyIndex);
            history.push(canvas.toDataURL());
            updateHistoryButtons();
        }
        
        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                loadFromHistory();
            }
        }
        
        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                loadFromHistory();
            }
        }
        
        function loadFromHistory() {
            const img = new Image();
            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                updateHistoryButtons();
            };
            img.src = history[historyIndex];
        }
        
        function updateHistoryButtons() {
            document.getElementById('undoBtn').disabled = historyIndex <= 0;
            document.getElementById('redoBtn').disabled = historyIndex >= history.length - 1;
        }
        
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
            
            document.getElementById('panelAdjust').classList.add('hidden');
            document.getElementById('panelEffects').classList.add('hidden');
            document.getElementById('panelVintage').classList.add('hidden');
            document.getElementById('panelFrames').classList.add('hidden');
            document.getElementById(`panel${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.remove('hidden');
        }
        
        // Adjustments
        function updateAdjustments() {
            if (!originalImage) return;
            
            const brightness = parseInt(document.getElementById('brightness').value);
            const contrast = parseInt(document.getElementById('contrast').value);
            const saturation = parseInt(document.getElementById('saturation').value);
            const exposure = parseInt(document.getElementById('exposure').value);
            const hue = parseInt(document.getElementById('hue').value);
            const blur = parseFloat(document.getElementById('blur').value);
            const vignette = parseInt(document.getElementById('vignette').value);
            
            // Update value displays
            document.getElementById('brightnessVal').textContent = brightness;
            document.getElementById('contrastVal').textContent = contrast;
            document.getElementById('saturationVal').textContent = saturation;
            document.getElementById('exposureVal').textContent = exposure;
            document.getElementById('temperatureVal').textContent = document.getElementById('temperature').value;
            document.getElementById('tintVal').textContent = document.getElementById('tint').value;
            document.getElementById('shadowsVal').textContent = document.getElementById('shadows').value;
            document.getElementById('highlightsVal').textContent = document.getElementById('highlights').value;
            document.getElementById('sharpnessVal').textContent = document.getElementById('sharpness').value;
            document.getElementById('vignetteVal').textContent = vignette;
            document.getElementById('blurVal').textContent = blur;
            document.getElementById('hueVal').textContent = hue + '¬∞';
            
            // Apply CSS filters
            const brightnessFilter = (brightness + 100) / 100;
            const contrastFilter = (contrast + 100) / 100;
            const saturationFilter = (saturation + 100) / 100;
            const exposureFilter = 1 + (exposure / 100);
            
            ctx.filter = `brightness(${brightnessFilter * exposureFilter}) contrast(${contrastFilter}) saturate(${saturationFilter}) hue-rotate(${hue}deg) blur(${blur}px)`;
            ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
            ctx.filter = 'none';
            
            // Apply temperature/tint
            const temperature = parseInt(document.getElementById('temperature').value);
            const tint = parseInt(document.getElementById('tint').value);
            if (temperature !== 0 || tint !== 0) {
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                for (let i = 0; i < data.length; i += 4) {
                    data[i] = Math.min(255, Math.max(0, data[i] + temperature * 0.5));
                    data[i + 2] = Math.min(255, Math.max(0, data[i + 2] - temperature * 0.5));
                    data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + tint * 0.3));
                }
                ctx.putImageData(imageData, 0, 0);
            }
            
            // Apply vignette
            if (vignette > 0) {
                const gradient = ctx.createRadialGradient(
                    canvas.width / 2, canvas.height / 2, canvas.width * 0.2,
                    canvas.width / 2, canvas.height / 2, canvas.width * 0.7
                );
                gradient.addColorStop(0, 'rgba(0,0,0,0)');
                gradient.addColorStop(1, `rgba(0,0,0,${vignette / 100})`);
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            renderOverlays();
        }
        
        function resetAdjustments() {
            document.getElementById('brightness').value = 0;
            document.getElementById('contrast').value = 0;
            document.getElementById('saturation').value = 0;
            document.getElementById('exposure').value = 0;
            document.getElementById('temperature').value = 0;
            document.getElementById('tint').value = 0;
            document.getElementById('shadows').value = 0;
            document.getElementById('highlights').value = 0;
            document.getElementById('sharpness').value = 0;
            document.getElementById('vignette').value = 0;
            document.getElementById('blur').value = 0;
            document.getElementById('hue').value = 0;
            updateAdjustments();
        }
        
        function resetImage() {
            if (originalImage) {
                resetAdjustments();
                ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
                currentFrame = 'none';
                overlays = { timestamp: false, rec: false, play: false, tracking: false };
                document.querySelectorAll('#panelFrames input[type="checkbox"]').forEach(cb => cb.checked = false);
                saveToHistory();
            }
        }
        
        // Effects
        function applyEffect(effect) {
            if (!originalImage) return;
            
            updateAdjustments();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            switch(effect) {
                case 'vhs':
                    for (let i = 0; i < data.length; i += 4) {
                        const noise = (Math.random() - 0.5) * 25;
                        data[i] = Math.min(255, Math.max(0, data[i] + noise + 15));
                        data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + noise));
                        data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + noise + 25));
                    }
                    // Add horizontal distortion
                    for (let y = 0; y < canvas.height; y++) {
                        if (Math.random() > 0.97) {
                            const offset = Math.floor((Math.random() - 0.5) * 30);
                            for (let x = 0; x < canvas.width; x++) {
                                const srcX = Math.min(canvas.width - 1, Math.max(0, x + offset));
                                const srcIdx = (y * canvas.width + srcX) * 4;
                                const dstIdx = (y * canvas.width + x) * 4;
                                data[dstIdx] = data[srcIdx];
                            }
                        }
                    }
                    break;
                    
                case 'glitch':
                    const tempData = new Uint8ClampedArray(data);
                    for (let y = 0; y < canvas.height; y++) {
                        if (Math.random() > 0.92) {
                            const offset = Math.floor((Math.random() - 0.5) * 60);
                            const sliceHeight = Math.floor(Math.random() * 20) + 5;
                            for (let dy = 0; dy < sliceHeight && y + dy < canvas.height; dy++) {
                                for (let x = 0; x < canvas.width; x++) {
                                    const srcX = Math.min(canvas.width - 1, Math.max(0, x + offset));
                                    const srcIdx = ((y + dy) * canvas.width + srcX) * 4;
                                    const dstIdx = ((y + dy) * canvas.width + x) * 4;
                                    data[dstIdx] = tempData[srcIdx];
                                    data[dstIdx + 1] = tempData[srcIdx + 1];
                                    data[dstIdx + 2] = tempData[srcIdx + 2];
                                }
                            }
                            y += sliceHeight;
                        }
                    }
                    // RGB shift
                    const shift = 8;
                    for (let y = 0; y < canvas.height; y++) {
                        for (let x = 0; x < canvas.width; x++) {
                            const idx = (y * canvas.width + x) * 4;
                            const rIdx = (y * canvas.width + Math.min(canvas.width - 1, x + shift)) * 4;
                            const bIdx = (y * canvas.width + Math.max(0, x - shift)) * 4;
                            data[idx] = tempData[rIdx];
                            data[idx + 2] = tempData[bIdx];
                        }
                    }
                    break;
                    
                case 'scanlines':
                    for (let y = 0; y < canvas.height; y += 2) {
                        for (let x = 0; x < canvas.width; x++) {
                            const idx = (y * canvas.width + x) * 4;
                            data[idx] *= 0.7;
                            data[idx + 1] *= 0.7;
                            data[idx + 2] *= 0.7;
                        }
                    }
                    break;
                    
                case 'chromatic':
                    const chromeData = new Uint8ClampedArray(data);
                    const chromeShift = 6;
                    for (let y = 0; y < canvas.height; y++) {
                        for (let x = 0; x < canvas.width; x++) {
                            const idx = (y * canvas.width + x) * 4;
                            const rIdx = (y * canvas.width + Math.min(canvas.width - 1, x + chromeShift)) * 4;
                            const bIdx = (y * canvas.width + Math.max(0, x - chromeShift)) * 4;
                            data[idx] = chromeData[rIdx];
                            data[idx + 2] = chromeData[bIdx];
                        }
                    }
                    break;
                    
                case 'pixelate':
                    const pixelSize = 6;
                    for (let y = 0; y < canvas.height; y += pixelSize) {
                        for (let x = 0; x < canvas.width; x += pixelSize) {
                            const idx = (y * canvas.width + x) * 4;
                            const r = data[idx], g = data[idx + 1], b = data[idx + 2];
                            for (let py = 0; py < pixelSize && y + py < canvas.height; py++) {
                                for (let px = 0; px < pixelSize && x + px < canvas.width; px++) {
                                    const pIdx = ((y + py) * canvas.width + (x + px)) * 4;
                                    data[pIdx] = r;
                                    data[pIdx + 1] = g;
                                    data[pIdx + 2] = b;
                                }
                            }
                        }
                    }
                    break;
                    
                case 'neon':
                    for (let i = 0; i < data.length; i += 4) {
                        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        if (brightness > 100) {
                            data[i] = Math.min(255, data[i] * 1.4);
                            data[i + 2] = Math.min(255, data[i + 2] * 1.5);
                        }
                        data[i + 1] *= 0.6;
                    }
                    break;
                    
                case 'cyberpunk':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 0.8 + 40);
                        data[i + 1] = data[i + 1] * 0.9;
                        data[i + 2] = Math.min(255, data[i + 2] * 1.3);
                    }
                    break;
                    
                case 'synthwave':
                    for (let i = 0; i < data.length; i += 4) {
                        const y = Math.floor((i / 4) / canvas.width) / canvas.height;
                        data[i] = Math.min(255, data[i] * (1.2 + y * 0.3));
                        data[i + 1] = data[i + 1] * (0.6 + y * 0.2);
                        data[i + 2] = Math.min(255, data[i + 2] * (1.4 - y * 0.3));
                    }
                    break;
                    
                case 'vaporwave':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 0.9 + 60);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.1 + 40);
                        data[i + 2] = Math.min(255, data[i + 2] * 1.2 + 70);
                    }
                    break;
                    
                case 'miami':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.3 + 30);
                        data[i + 1] = data[i + 1] * 0.85;
                        data[i + 2] = Math.min(255, data[i + 2] * 1.2 + 50);
                    }
                    break;
                    
                case 'tokyo':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.1 + 20);
                        data[i + 1] = data[i + 1] * 0.7;
                        data[i + 2] = Math.min(255, data[i + 2] * 1.5);
                    }
                    break;
                    
                case 'arcade':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.round(data[i] / 51) * 51;
                        data[i + 1] = Math.round(data[i + 1] / 51) * 51;
                        data[i + 2] = Math.round(data[i + 2] / 51) * 51;
                    }
                    break;
                    
                case 'duotone':
                    for (let i = 0; i < data.length; i += 4) {
                        const gray = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        data[i] = Math.min(255, gray * 1.5);
                        data[i + 1] = gray * 0.2;
                        data[i + 2] = Math.min(255, gray * 1.8);
                    }
                    break;
                    
                case 'noir':
                    for (let i = 0; i < data.length; i += 4) {
                        const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
                        const contrast = ((gray - 128) * 1.4) + 128;
                        data[i] = data[i + 1] = data[i + 2] = Math.min(255, Math.max(0, contrast));
                    }
                    break;
            }
            
            ctx.putImageData(imageData, 0, 0);
            renderOverlays();
            saveToHistory();
        }
        
        // Vintage effects
        function applyVintage(effect) {
            if (!originalImage) return;
            
            updateAdjustments();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            switch(effect) {
                case 'sepia':
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i], g = data[i + 1], b = data[i + 2];
                        data[i] = Math.min(255, r * 0.393 + g * 0.769 + b * 0.189);
                        data[i + 1] = Math.min(255, r * 0.349 + g * 0.686 + b * 0.168);
                        data[i + 2] = Math.min(255, r * 0.272 + g * 0.534 + b * 0.131);
                    }
                    break;
                    
                case 'faded':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 0.9 + 25);
                        data[i + 1] = Math.min(255, data[i + 1] * 0.85 + 20);
                        data[i + 2] = Math.min(255, data[i + 2] * 0.8 + 30);
                    }
                    break;
                    
                case 'polaroid':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.1 + 10);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.05 + 10);
                        data[i + 2] = data[i + 2] * 0.9 + 20;
                    }
                    break;
                    
                case 'kodak':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.15 + 15);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.05 + 5);
                        data[i + 2] = data[i + 2] * 0.85;
                    }
                    break;
                    
                case 'fuji':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = data[i] * 0.95;
                        data[i + 1] = Math.min(255, data[i + 1] * 1.15);
                        data[i + 2] = Math.min(255, data[i + 2] * 1.1);
                    }
                    break;
                    
                case 'agfa':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.2);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.1);
                        data[i + 2] = data[i + 2] * 0.8;
                    }
                    break;
                    
                case 'grain':
                    for (let i = 0; i < data.length; i += 4) {
                        const grain = (Math.random() - 0.5) * 40;
                        data[i] = Math.min(255, Math.max(0, data[i] + grain));
                        data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + grain));
                        data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + grain));
                    }
                    break;
                    
                case 'dusty':
                    for (let i = 0; i < data.length; i += 4) {
                        if (Math.random() > 0.995) {
                            data[i] = data[i + 1] = data[i + 2] = 255;
                        }
                        const grain = (Math.random() - 0.5) * 20;
                        data[i] = Math.min(255, Math.max(0, data[i] + grain + 10));
                        data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + grain + 5));
                        data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + grain));
                    }
                    break;
                    
                case 'lightleak':
                    for (let i = 0; i < data.length; i += 4) {
                        const x = (i / 4) % canvas.width;
                        const y = Math.floor((i / 4) / canvas.width);
                        const dist = Math.sqrt(Math.pow(x - canvas.width * 0.8, 2) + Math.pow(y - canvas.height * 0.2, 2));
                        const maxDist = Math.sqrt(Math.pow(canvas.width, 2) + Math.pow(canvas.height, 2)) * 0.5;
                        const intensity = Math.max(0, 1 - dist / maxDist) * 100;
                        data[i] = Math.min(255, data[i] + intensity * 1.5);
                        data[i + 1] = Math.min(255, data[i + 1] + intensity * 0.8);
                    }
                    break;
                    
                case 'oldphoto':
                    for (let i = 0; i < data.length; i += 4) {
                        const gray = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        const sepia_r = Math.min(255, gray * 1.1 + 30);
                        const sepia_g = Math.min(255, gray * 0.9 + 15);
                        const sepia_b = Math.min(255, gray * 0.7);
                        const grain = (Math.random() - 0.5) * 30;
                        data[i] = Math.min(255, sepia_r + grain);
                        data[i + 1] = Math.min(255, sepia_g + grain);
                        data[i + 2] = Math.min(255, sepia_b + grain);
                    }
                    break;
                    
                case '1970s':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.1 + 20);
                        data[i + 1] = Math.min(255, data[i + 1] * 0.95 + 10);
                        data[i + 2] = data[i + 2] * 0.8;
                        const grain = (Math.random() - 0.5) * 15;
                        data[i] += grain;
                        data[i + 1] += grain;
                        data[i + 2] += grain;
                    }
                    break;
                    
                case '1980s':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.2 + 15);
                        data[i + 1] = data[i + 1] * 0.85;
                        data[i + 2] = Math.min(255, data[i + 2] * 1.3 + 20);
                    }
                    break;
                    
                case '1990s':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.05 + 5);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.1);
                        data[i + 2] = Math.min(255, data[i + 2] * 1.15 + 10);
                    }
                    break;
                    
                case 'daguerreotype':
                    for (let i = 0; i < data.length; i += 4) {
                        const gray = (data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114);
                        const contrast = ((gray - 128) * 1.3) + 128;
                        data[i] = Math.min(255, contrast + 20);
                        data[i + 1] = Math.min(255, contrast + 10);
                        data[i + 2] = contrast;
                    }
                    break;
            }
            
            ctx.putImageData(imageData, 0, 0);
            renderOverlays();
            saveToHistory();
        }
        
        // Frames
        function applyFrame(frame) {
            currentFrame = frame;
            updateAdjustments();
            saveToHistory();
        }
        
        // Overlays
        function toggleOverlay(overlay) {
            overlays[overlay] = !overlays[overlay];
            updateAdjustments();
        }
        
        function renderOverlays() {
            ctx.font = '20px VT323, monospace';
            
            if (currentFrame === 'vhsFrame') {
                // Top gradient
                const topGrad = ctx.createLinearGradient(0, 0, 0, 50);
                topGrad.addColorStop(0, 'rgba(0,0,0,0.7)');
                topGrad.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = topGrad;
                ctx.fillRect(0, 0, canvas.width, 50);
                
                // Bottom gradient
                const bottomGrad = ctx.createLinearGradient(0, canvas.height - 50, 0, canvas.height);
                bottomGrad.addColorStop(0, 'rgba(0,0,0,0)');
                bottomGrad.addColorStop(1, 'rgba(0,0,0,0.7)');
                ctx.fillStyle = bottomGrad;
                ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
            }
            
            if (currentFrame === 'polaroidFrame') {
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 15;
                ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, canvas.height - 60, canvas.width, 60);
            }
            
            if (currentFrame === 'neonBorder') {
                ctx.strokeStyle = '#ff2a6d';
                ctx.lineWidth = 4;
                ctx.shadowColor = '#ff2a6d';
                ctx.shadowBlur = 15;
                ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
                ctx.strokeStyle = '#05d9e8';
                ctx.strokeRect(15, 15, canvas.width - 30, canvas.height - 30);
                ctx.shadowBlur = 0;
            }
            
            if (overlays.timestamp) {
                const now = new Date();
                const year = 1985 + Math.floor(Math.random() * 10);
                const text = `${now.getMonth() + 1}/${now.getDate()}/${year} ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
                ctx.fillStyle = '#ffcc00';
                ctx.font = 'bold 24px VT323, monospace';
                ctx.shadowColor = '#000';
                ctx.shadowBlur = 4;
                ctx.fillText(text, canvas.width - 180, canvas.height - 20);
                ctx.shadowBlur = 0;
            }
            
            if (overlays.rec) {
                ctx.fillStyle = '#ff0000';
                ctx.beginPath();
                ctx.arc(30, 30, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 20px VT323, monospace';
                ctx.fillText('REC', 45, 36);
            }
            
            if (overlays.play) {
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 24px VT323, monospace';
                ctx.fillText('‚ñ∂ PLAY', 20, canvas.height - 20);
            }
            
            if (overlays.tracking) {
                const y = canvas.height / 2 + (Math.random() - 0.5) * 20;
                ctx.fillStyle = 'rgba(0,0,0,0.8)';
                ctx.fillRect(0, y - 15, canvas.width, 30);
                for (let i = 0; i < 5; i++) {
                    const barY = y - 10 + Math.random() * 20;
                    ctx.fillStyle = 'rgba(255,255,255,0.3)';
                    ctx.fillRect(0, barY, canvas.width, 2);
                }
            }
        }
        
        // Transform functions
        function rotateImage(degrees) {
            if (!originalImage) return;
            
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            
            if (degrees === 90 || degrees === -90) {
                tempCanvas.width = canvas.height;
                tempCanvas.height = canvas.width;
            } else {
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
            }
            
            tempCtx.translate(tempCanvas.width / 2, tempCanvas.height / 2);
            tempCtx.rotate(degrees * Math.PI / 180);
            tempCtx.drawImage(canvas, -canvas.width / 2, -canvas.height / 2);
            
            canvas.width = tempCanvas.width;
            canvas.height = tempCanvas.height;
            ctx.drawImage(tempCanvas, 0, 0);
            
            const tempImg = new Image();
            tempImg.onload = () => {
                originalImage = tempImg;
            };
            tempImg.src = canvas.toDataURL();
            
            saveToHistory();
        }
        
        function flipImage(direction) {
            if (!originalImage) return;
            
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            
            if (direction === 'h') {
                tempCtx.translate(canvas.width, 0);
                tempCtx.scale(-1, 1);
            } else {
                tempCtx.translate(0, canvas.height);
                tempCtx.scale(1, -1);
            }
            
            tempCtx.drawImage(canvas, 0, 0);
            ctx.drawImage(tempCanvas, 0, 0);
            
            const tempImg = new Image();
            tempImg.onload = () => {
                originalImage = tempImg;
            };
            tempImg.src = canvas.toDataURL();
            
            saveToHistory();
        }
        
        // Zoom
        function zoomCanvas(delta) {
            zoom = Math.max(0.1, Math.min(3, zoom + delta));
            canvas.style.transform = `scale(${zoom})`;
            document.getElementById('zoomLevel').textContent = Math.round(zoom * 100) + '%';
        }
        
        function resetZoom() {
            zoom = 1;
            canvas.style.transform = 'scale(1)';
            document.getElementById('zoomLevel').textContent = '100%';
        }
        
        // Drawing tools
        function setTool(tool) {
            currentTool = currentTool === tool ? null : tool;
            document.getElementById('brushTool').classList.toggle('active', currentTool === 'brush');
            document.getElementById('eraserTool').classList.toggle('active', currentTool === 'eraser');
            canvas.style.cursor = currentTool ? 'crosshair' : 'default';
        }
        
        function updateBrushColor() {
            // Color is read directly when drawing
        }
        
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        
        function startDrawing(e) {
            if (!currentTool) return;
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            lastX = (e.clientX - rect.left) * (canvas.width / rect.width);
            lastY = (e.clientY - rect.top) * (canvas.height / rect.height);
        }
        
        function draw(e) {
            if (!isDrawing || !currentTool) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (canvas.width / rect.width);
            const y = (e.clientY - rect.top) * (canvas.height / rect.height);
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : document.getElementById('brushColor').value;
            ctx.lineWidth = document.getElementById('brushSize').value;
            ctx.lineCap = 'round';
            ctx.stroke();
            
            lastX = x;
            lastY = y;
        }
        
        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                saveToHistory();
            }
        }
        
        // Text tool
        function addText() {
            if (!originalImage) return;
            
            const text = document.getElementById('textInput').value;
            if (!text) return;
            
            const font = document.getElementById('textFont').value;
            const size = document.getElementById('textSize').value;
            const color = document.getElementById('brushColor').value;
            
            ctx.font = `${size}px ${font}, monospace`;
            ctx.fillStyle = color;
            ctx.shadowColor = color;
            ctx.shadowBlur = 10;
            ctx.fillText(text, canvas.width / 2 - ctx.measureText(text).width / 2, canvas.height / 2);
            ctx.shadowBlur = 0;
            
            saveToHistory();
        }
        
        // Crop
        function setCropRatio(ratio) {
            cropRatio = ratio;
        }
        
        function toggleCrop() {
            isCropping = !isCropping;
            document.getElementById('cropBtn').classList.toggle('active', isCropping);
        }
        
        // Download
        function downloadImage(format) {
            if (!originalImage) return;
            
            const link = document.createElement('a');
            const timestamp = new Date().getTime();
            
            if (format === 'jpg') {
                link.download = `neon_memories_${timestamp}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
            } else {
                link.download = `neon_memories_${timestamp}.png`;
                link.href = canvas.toDataURL('image/png');
            }
            
            link.click();
        }
    </script>
</body>
</html>