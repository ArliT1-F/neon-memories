<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON MEMORIES ‚Ä¢ Retro Photo Editor</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=VT323&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-pink: #ff2a6d;
            --neon-blue: #05d9e8;
            --neon-purple: #d300c5;
            --neon-yellow: #ffe66d;
            --dark-bg: #0d0221;
            --dark-surface: #1a0a2e;
            --dark-card: #16082a;
            --accent-gradient: linear-gradient(135deg, #ff2a6d, #d300c5, #05d9e8);
        }
        
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--neon-pink) var(--dark-surface);
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        *::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        
        *::-webkit-scrollbar-track {
            background: var(--dark-surface);
        }
        
        *::-webkit-scrollbar-thumb {
            background: var(--neon-pink);
            border-radius: 3px;
        }
        
        body {
            font-family: 'Orbitron', sans-serif;
            background: var(--dark-bg);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
        }
        
        .vhs-font {
            font-family: 'VT323', monospace;
        }
        
        .pixel-font {
            font-family: 'Press Start 2P', cursive;
        }
        
        /* Animated background */
        .bg-grid {
            position: fixed;
            inset: 0;
            background: 
                linear-gradient(180deg, rgba(13, 2, 33, 0.95) 0%, rgba(13, 2, 33, 0.7) 50%, rgba(13, 2, 33, 0.9) 100%),
                repeating-linear-gradient(90deg, transparent 0, rgba(5, 217, 232, 0.03) 1px, transparent 1px, transparent 80px),
                repeating-linear-gradient(0deg, transparent 0, rgba(255, 42, 109, 0.03) 1px, transparent 1px, transparent 80px);
            z-index: -2;
        }
        
        .retro-sun {
            position: fixed;
            bottom: -150px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            height: 400px;
            background: linear-gradient(180deg, #ffe66d 0%, #ff9e2a 20%, #ff2a6d 50%, #d300c5 75%, #4a0080 100%);
            border-radius: 50%;
            z-index: -1;
            opacity: 0.3;
            filter: blur(2px);
        }
        
        @media (min-width: 768px) {
            .retro-sun {
                width: 500px;
                height: 500px;
                opacity: 0.4;
            }
        }
        
        .retro-sun::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent 0px,
                transparent 10px,
                rgba(13, 2, 33, 0.8) 10px,
                rgba(13, 2, 33, 0.8) 15px
            );
            border-radius: 50%;
        }
        
        .perspective-grid {
            position: fixed;
            bottom: 0;
            left: -50%;
            right: -50%;
            height: 30vh;
            background: 
                repeating-linear-gradient(90deg, rgba(5, 217, 232, 0.15) 0, rgba(5, 217, 232, 0.15) 1px, transparent 1px, transparent 60px),
                repeating-linear-gradient(180deg, rgba(255, 42, 109, 0.1) 0, rgba(255, 42, 109, 0.1) 1px, transparent 1px, transparent 40px);
            transform: perspective(500px) rotateX(65deg);
            transform-origin: center top;
            z-index: -1;
            animation: gridMove 20s linear infinite;
        }
        
        @keyframes gridMove {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 0 0, 0 400px; }
        }
        
        /* Neon glow effects */
        .neon-text-pink {
            text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink);
        }
        
        @media (min-width: 768px) {
            .neon-text-pink {
                text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink), 0 0 40px var(--neon-pink);
            }
        }
        
        .neon-text-blue {
            text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
        }
        
        /* Cards and panels */
        .glass-panel {
            background: linear-gradient(135deg, rgba(26, 10, 46, 0.95) 0%, rgba(22, 8, 42, 0.98) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 42, 109, 0.2);
            border-radius: 12px;
        }
        
        .tool-section {
            background: rgba(13, 2, 33, 0.6);
            border: 1px solid rgba(5, 217, 232, 0.15);
            border-radius: 8px;
        }
        
        /* Buttons - Mobile optimized */
        .btn-neon {
            background: linear-gradient(135deg, rgba(255, 42, 109, 0.2) 0%, rgba(211, 0, 197, 0.2) 100%);
            border: 1px solid var(--neon-pink);
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            font-family: 'VT323', monospace;
            font-size: 14px;
            letter-spacing: 1px;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (min-width: 768px) {
            .btn-neon {
                font-size: 16px;
                padding: 8px 16px;
                min-height: auto;
            }
        }
        
        .btn-neon:hover, .btn-neon:active {
            background: linear-gradient(135deg, rgba(255, 42, 109, 0.4) 0%, rgba(211, 0, 197, 0.4) 100%);
            box-shadow: 0 0 20px rgba(255, 42, 109, 0.5);
        }
        
        .btn-neon.active {
            background: linear-gradient(135deg, var(--neon-pink) 0%, var(--neon-purple) 100%);
            box-shadow: 0 0 20px rgba(255, 42, 109, 0.7);
        }
        
        .btn-icon {
            background: rgba(5, 217, 232, 0.1);
            border: 1px solid rgba(5, 217, 232, 0.3);
            color: var(--neon-blue);
            width: 44px;
            height: 44px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .btn-icon:hover, .btn-icon:active {
            background: rgba(5, 217, 232, 0.2);
            box-shadow: 0 0 15px rgba(5, 217, 232, 0.4);
        }
        
        .btn-icon.active {
            background: var(--neon-blue);
            color: var(--dark-bg);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--neon-pink) 0%, var(--neon-purple) 100%);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            font-size: 12px;
            letter-spacing: 1px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(255, 42, 109, 0.4);
            min-height: 44px;
        }
        
        @media (min-width: 768px) {
            .btn-primary {
                font-size: 14px;
                letter-spacing: 2px;
                padding: 12px 24px;
            }
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        /* Sliders - Touch optimized */
        .slider-wrapper {
            position: relative;
            padding: 4px 0;
        }
        
        .slider-wrapper input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--dark-surface) 0%, var(--dark-surface) 100%);
            border-radius: 4px;
            outline: none;
            border: 1px solid rgba(5, 217, 232, 0.2);
        }
        
        .slider-wrapper input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-pink));
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--neon-blue);
        }
        
        .slider-wrapper input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-pink));
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--neon-blue);
            border: none;
        }
        
        /* Canvas area */
        .canvas-wrapper {
            background: 
                linear-gradient(45deg, rgba(13, 2, 33, 0.8) 25%, transparent 25%),
                linear-gradient(-45deg, rgba(13, 2, 33, 0.8) 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, rgba(13, 2, 33, 0.8) 75%),
                linear-gradient(-45deg, transparent 75%, rgba(13, 2, 33, 0.8) 75%);
            background-size: 16px 16px;
            background-position: 0 0, 0 8px, 8px -8px, -8px 0px;
            background-color: #0a0118;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        
        /* Tabs */
        .tab-btn {
            padding: 12px 12px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-family: 'VT323', monospace;
            font-size: 16px;
            letter-spacing: 1px;
            transition: all 0.2s ease;
            position: relative;
            white-space: nowrap;
            min-height: 44px;
        }
        
        @media (min-width: 768px) {
            .tab-btn {
                padding: 10px 16px;
                font-size: 18px;
            }
        }
        
        .tab-btn:hover, .tab-btn:active {
            color: var(--neon-blue);
        }
        
        .tab-btn.active {
            color: var(--neon-pink);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--neon-pink);
            box-shadow: 0 0 10px var(--neon-pink);
        }
        
        /* Effect cards - Touch optimized */
        .effect-card {
            background: rgba(13, 2, 33, 0.6);
            border: 1px solid rgba(255, 42, 109, 0.2);
            border-radius: 8px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .effect-card:active {
            transform: scale(0.95);
            border-color: var(--neon-pink);
            box-shadow: 0 0 20px rgba(255, 42, 109, 0.3);
        }
        
        .effect-card.active {
            border-color: var(--neon-blue);
            background: rgba(5, 217, 232, 0.1);
            box-shadow: 0 0 20px rgba(5, 217, 232, 0.4);
        }
        
        /* Scanline effect */
        .scanlines::after {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
        }
        
        /* VHS timestamp style */
        .vhs-display {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 230, 109, 0.3);
            padding: 4px 10px;
            font-family: 'VT323', monospace;
            color: var(--neon-yellow);
            text-shadow: 0 0 5px var(--neon-yellow);
            font-size: 12px;
        }
        
        @media (min-width: 768px) {
            .vhs-display {
                padding: 4px 12px;
                font-size: 14px;
            }
        }
        
        /* Animations */
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            92% { opacity: 1; }
            93% { opacity: 0.8; }
            94% { opacity: 1; }
            95% { opacity: 0.9; }
        }
        
        .flicker {
            animation: flicker 3s infinite;
        }
        
        /* Hide scrollbar for tab container */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* Upload area */
        .upload-zone {
            border: 2px dashed rgba(5, 217, 232, 0.4);
            border-radius: 16px;
            background: rgba(5, 217, 232, 0.02);
            transition: all 0.3s ease;
        }
        
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--neon-pink);
            background: rgba(255, 42, 109, 0.05);
            box-shadow: 0 0 30px rgba(255, 42, 109, 0.2);
        }
        
        /* History buttons */
        .history-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            padding: 8px 10px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 12px;
            min-height: 36px;
        }
        
        @media (min-width: 768px) {
            .history-btn {
                padding: 8px 12px;
                font-size: 14px;
            }
        }
        
        .history-btn:active:not(:disabled) {
            background: rgba(5, 217, 232, 0.1);
            border-color: var(--neon-blue);
            color: var(--neon-blue);
        }
        
        .history-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Color picker wrapper */
        .color-picker-wrapper {
            position: relative;
            width: 44px;
            height: 44px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--neon-blue);
            flex-shrink: 0;
        }
        
        .color-picker-wrapper input[type="color"] {
            position: absolute;
            inset: -10px;
            width: calc(100% + 20px);
            height: calc(100% + 20px);
            cursor: pointer;
            border: none;
        }
        
        /* Mobile Bottom Navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(13, 2, 33, 0.95) 0%, rgba(22, 8, 42, 1) 100%);
            border-top: 1px solid rgba(255, 42, 109, 0.3);
            padding: 8px 12px;
            padding-bottom: max(8px, env(safe-area-inset-bottom));
            z-index: 100;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
        }
        
        @media (min-width: 1024px) {
            .mobile-nav {
                display: none;
            }
        }
        
        .mobile-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 10px;
            font-family: 'VT323', monospace;
            transition: all 0.2s;
            border: none;
            background: transparent;
        }
        
        .mobile-nav-btn.active {
            color: var(--neon-pink);
            background: rgba(255, 42, 109, 0.1);
        }
        
        .mobile-nav-btn span:first-child {
            font-size: 20px;
        }
        
        /* Mobile Panel Overlay */
        .mobile-panel-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 90;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .mobile-panel-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Mobile Slide-up Panel */
        .mobile-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-height: 70vh;
            background: linear-gradient(180deg, rgba(26, 10, 46, 0.98) 0%, rgba(22, 8, 42, 1) 100%);
            border-top: 1px solid rgba(255, 42, 109, 0.3);
            border-radius: 20px 20px 0 0;
            z-index: 95;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            overflow: hidden;
            padding-bottom: max(60px, calc(60px + env(safe-area-inset-bottom)));
        }
        
        .mobile-panel.active {
            transform: translateY(0);
        }
        
        .mobile-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid rgba(255, 42, 109, 0.2);
            position: sticky;
            top: 0;
            background: inherit;
            z-index: 10;
        }
        
        .mobile-panel-content {
            padding: 16px;
            overflow-y: auto;
            max-height: calc(70vh - 60px - 60px);
        }
        
        .panel-handle {
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 auto 8px;
        }
        
        /* Desktop sidebar - hide on mobile */
        @media (max-width: 1023px) {
            .desktop-sidebar {
                display: none !important;
            }
            
            main {
                padding-bottom: 80px;
            }
        }
        
        /* Input styling for mobile */
        input[type="text"], input[type="number"], select {
            font-size: 16px !important; /* Prevents zoom on iOS */
        }
        
        /* Safe area padding for mobile */
        .safe-bottom {
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }
        
        /* Checkbox styling */
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .checkbox-wrapper:active {
            background: rgba(255, 42, 109, 0.1);
        }
        
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--neon-pink);
        }
    </style>
</head>
<body class="text-white min-h-screen">
    <!-- Background elements -->
    <div class="bg-grid"></div>
    <div class="retro-sun"></div>
    <div class="perspective-grid"></div>
    
    <!-- Header -->
    <header class="relative z-10 px-3 sm:px-6 py-3 sm:py-4 border-b border-pink-500/20">
        <div class="max-w-screen-2xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-2 sm:gap-4">
                <div class="text-2xl sm:text-3xl">üìº</div>
                <div>
                    <h1 class="text-lg sm:text-2xl font-black text-pink-400 neon-text-pink tracking-wider flicker">NEON MEMORIES</h1>
                    <p class="vhs-font text-xs sm:text-sm text-cyan-400 opacity-80 hidden sm:block">RETRO PHOTO EDITOR ‚Ä¢ EST. 1985</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2 sm:gap-4">
                <div class="vhs-display hidden md:block">
                    <span id="timestamp">JAN 01 1989 00:00:00</span>
                </div>
                <div class="flex items-center gap-1 sm:gap-2">
                    <button onclick="undo()" id="undoBtn" class="history-btn vhs-font" disabled>
                        ‚Ü∂ <span class="hidden sm:inline">UNDO</span>
                    </button>
                    <button onclick="redo()" id="redoBtn" class="history-btn vhs-font" disabled>
                        <span class="hidden sm:inline">REDO</span> ‚Ü∑
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="relative z-10 max-w-screen-2xl mx-auto p-3 sm:p-4 lg:p-6">
        <div class="grid lg:grid-cols-12 gap-4 lg:gap-6">
            
            <!-- Left Sidebar - Tools (Desktop only) -->
            <aside class="lg:col-span-3 xl:col-span-2 desktop-sidebar">
                <div class="glass-panel p-4 space-y-4 sticky top-4">
                    <h2 class="vhs-font text-xl text-cyan-400 neon-text-blue flex items-center gap-2">
                        <span>üîß</span> TOOLS
                    </h2>
                    
                    <!-- Transform Tools -->
                    <div class="tool-section p-3">
                        <h3 class="vhs-font text-sm text-pink-400 mb-3">TRANSFORM</h3>
                        <div class="grid grid-cols-4 gap-2">
                            <button onclick="rotateImage(-90)" class="btn-icon">‚Ü∫</button>
                            <button onclick="rotateImage(90)" class="btn-icon">‚Üª</button>
                            <button onclick="flipImage('h')" class="btn-icon">‚áÜ</button>
                            <button onclick="flipImage('v')" class="btn-icon">‚áÖ</button>
                        </div>
                    </div>
                    
                    <!-- Drawing Tools -->
                    <div class="tool-section p-3">
                        <h3 class="vhs-font text-sm text-pink-400 mb-3">DRAW</h3>
                        <div class="flex items-center gap-2 mb-3">
                            <button onclick="setTool('brush')" class="btn-icon flex-1" id="brushTool">üñåÔ∏è</button>
                            <button onclick="setTool('eraser')" class="btn-icon flex-1" id="eraserTool">üßπ</button>
                            <div class="color-picker-wrapper">
                                <input type="color" id="brushColor" value="#ff2a6d">
                            </div>
                        </div>
                        <div class="slider-wrapper">
                            <label class="vhs-font text-xs text-gray-400">BRUSH SIZE</label>
                            <input type="range" id="brushSize" min="1" max="50" value="5">
                        </div>
                    </div>
                    
                    <!-- Text Tool -->
                    <div class="tool-section p-3">
                        <h3 class="vhs-font text-sm text-pink-400 mb-3">TEXT</h3>
                        <input type="text" id="textInput" placeholder="Enter text..." 
                            class="w-full bg-black/50 border border-cyan-500/30 rounded px-3 py-2 text-sm mb-2 focus:border-pink-500 focus:outline-none">
                        <div class="flex gap-2 mb-2">
                            <select id="textFont" class="flex-1 bg-black/50 border border-cyan-500/30 rounded px-2 py-2 text-xs">
                                <option value="VT323">VHS</option>
                                <option value="Orbitron">RETRO</option>
                                <option value="Press Start 2P">PIXEL</option>
                            </select>
                            <input type="number" id="textSize" value="32" min="8" max="120" 
                                class="w-16 bg-black/50 border border-cyan-500/30 rounded px-2 py-2 text-xs">
                        </div>
                        <button onclick="addText()" class="btn-neon w-full">ADD TEXT</button>
                    </div>
                </div>
            </aside>
            
            <!-- Center - Canvas -->
            <section class="lg:col-span-6 xl:col-span-7">
                <div class="glass-panel p-3 sm:p-4">
                    <!-- Toolbar -->
                    <div class="flex items-center justify-between mb-3 sm:mb-4 flex-wrap gap-2">
                        <div class="flex items-center gap-1 sm:gap-2">
                            <button onclick="zoomCanvas(-0.1)" class="btn-icon text-sm w-10 h-10 sm:w-11 sm:h-11">‚àí</button>
                            <span class="vhs-font text-cyan-400 min-w-[50px] sm:min-w-[60px] text-center text-sm" id="zoomLevel">100%</span>
                            <button onclick="zoomCanvas(0.1)" class="btn-icon text-sm w-10 h-10 sm:w-11 sm:h-11">+</button>
                            <button onclick="resetZoom()" class="btn-icon text-sm w-10 h-10 sm:w-11 sm:h-11">‚ü≤</button>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="document.getElementById('fileInput').click()" class="btn-primary text-xs sm:text-sm">
                                üìÅ <span class="hidden xs:inline">LOAD</span> IMAGE
                            </button>
                            <input type="file" id="fileInput" accept="image/*" class="hidden">
                        </div>
                    </div>
                    
                    <!-- Canvas Container -->
                    <div class="canvas-wrapper scanlines relative min-h-[250px] sm:min-h-[350px] lg:min-h-[450px] flex items-center justify-center" 
                         id="canvasContainer">
                        <canvas id="photoCanvas" class="max-w-full max-h-full hidden"></canvas>
                        
                        <!-- Upload Prompt -->
                        <div id="uploadPrompt" class="upload-zone absolute inset-2 sm:inset-4 flex flex-col items-center justify-center p-4">
                            <div class="text-5xl sm:text-6xl mb-3 sm:mb-4 animate-bounce">üì∏</div>
                            <p class="vhs-font text-lg sm:text-2xl text-cyan-400 mb-1 sm:mb-2 text-center">DROP YOUR PHOTO HERE</p>
                            <p class="vhs-font text-sm sm:text-lg text-pink-400 text-center">or tap LOAD IMAGE above</p>
                            <div class="mt-4 sm:mt-6 flex gap-2 sm:gap-4 vhs-font text-xs sm:text-sm text-gray-500">
                                <span>JPG</span>
                                <span>‚Ä¢</span>
                                <span>PNG</span>
                                <span>‚Ä¢</span>
                                <span>GIF</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bottom Actions -->
                    <div class="flex items-center justify-between mt-3 sm:mt-4 flex-wrap gap-3">
                        <div class="flex items-center gap-2 vhs-font text-xs sm:text-sm text-gray-400">
                            <span id="imageInfo">No image loaded</span>
                        </div>
                        <div class="flex items-center gap-2 flex-wrap">
                            <button onclick="resetImage()" class="btn-neon text-xs sm:text-sm">‚Ü∫ RESET</button>
                            <button onclick="downloadImage('png')" class="btn-primary text-xs sm:text-sm">üíæ SAVE</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Right Sidebar - Effects & Adjustments (Desktop only) -->
            <aside class="lg:col-span-3 desktop-sidebar">
                <div class="glass-panel p-4 sticky top-4">
                    <!-- Tabs -->
                    <div class="flex border-b border-pink-500/20 mb-4 overflow-x-auto hide-scrollbar">
                        <button onclick="switchTab('adjust')" class="tab-btn active" id="tabAdjust">ADJUST</button>
                        <button onclick="switchTab('effects')" class="tab-btn" id="tabEffects">EFFECTS</button>
                        <button onclick="switchTab('vintage')" class="tab-btn" id="tabVintage">VINTAGE</button>
                        <button onclick="switchTab('frames')" class="tab-btn" id="tabFrames">FRAMES</button>
                    </div>
                    
                    <!-- Adjust Panel -->
                    <div id="panelAdjust" class="space-y-4 max-h-[55vh] overflow-y-auto pr-2">
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">BRIGHTNESS</label>
                                <span class="vhs-font text-xs text-cyan-400" id="brightnessVal">0</span>
                            </div>
                            <input type="range" id="brightness" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">CONTRAST</label>
                                <span class="vhs-font text-xs text-cyan-400" id="contrastVal">0</span>
                            </div>
                            <input type="range" id="contrast" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">SATURATION</label>
                                <span class="vhs-font text-xs text-cyan-400" id="saturationVal">0</span>
                            </div>
                            <input type="range" id="saturation" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">EXPOSURE</label>
                                <span class="vhs-font text-xs text-cyan-400" id="exposureVal">0</span>
                            </div>
                            <input type="range" id="exposure" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">TEMPERATURE</label>
                                <span class="vhs-font text-xs text-cyan-400" id="temperatureVal">0</span>
                            </div>
                            <input type="range" id="temperature" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">TINT</label>
                                <span class="vhs-font text-xs text-cyan-400" id="tintVal">0</span>
                            </div>
                            <input type="range" id="tint" min="-100" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">VIGNETTE</label>
                                <span class="vhs-font text-xs text-cyan-400" id="vignetteVal">0</span>
                            </div>
                            <input type="range" id="vignette" min="0" max="100" value="0" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">BLUR</label>
                                <span class="vhs-font text-xs text-cyan-400" id="blurVal">0</span>
                            </div>
                            <input type="range" id="blur" min="0" max="20" value="0" step="0.5" oninput="updateAdjustments()">
                        </div>
                        
                        <div class="slider-wrapper">
                            <div class="flex justify-between mb-1">
                                <label class="vhs-font text-sm text-pink-400">HUE ROTATE</label>
                                <span class="vhs-font text-xs text-cyan-400" id="hueVal">0¬∞</span>
                            </div>
                            <input type="range" id="hue" min="0" max="360" value="0" oninput="updateAdjustments()">
                        </div>
                    </div>
                    
                    <!-- Effects Panel -->
                    <div id="panelEffects" class="hidden grid grid-cols-2 gap-2 max-h-[55vh] overflow-y-auto pr-2">
                        <div class="effect-card" onclick="applyEffect('vhs')">
                            <div class="text-2xl mb-1">üìº</div>
                            <div class="vhs-font text-xs">VHS</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('glitch')">
                            <div class="text-2xl mb-1">üëæ</div>
                            <div class="vhs-font text-xs">GLITCH</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('scanlines')">
                            <div class="text-2xl mb-1">üì∫</div>
                            <div class="vhs-font text-xs">SCANLINES</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('chromatic')">
                            <div class="text-2xl mb-1">üåà</div>
                            <div class="vhs-font text-xs">RGB SPLIT</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('pixelate')">
                            <div class="text-2xl mb-1">üéÆ</div>
                            <div class="vhs-font text-xs">8-BIT</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('neon')">
                            <div class="text-2xl mb-1">üíú</div>
                            <div class="vhs-font text-xs">NEON</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('cyberpunk')">
                            <div class="text-2xl mb-1">üåÉ</div>
                            <div class="vhs-font text-xs">CYBER</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('synthwave')">
                            <div class="text-2xl mb-1">üåÖ</div>
                            <div class="vhs-font text-xs">SYNTH</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('vaporwave')">
                            <div class="text-2xl mb-1">üå¥</div>
                            <div class="vhs-font text-xs">VAPOR</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('miami')">
                            <div class="text-2xl mb-1">üèñÔ∏è</div>
                            <div class="vhs-font text-xs">MIAMI</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('tokyo')">
                            <div class="text-2xl mb-1">üóº</div>
                            <div class="vhs-font text-xs">TOKYO</div>
                        </div>
                        <div class="effect-card" onclick="applyEffect('duotone')">
                            <div class="text-2xl mb-1">üé®</div>
                            <div class="vhs-font text-xs">DUOTONE</div>
                        </div>
                    </div>
                    
                    <!-- Vintage Panel -->
                    <div id="panelVintage" class="hidden grid grid-cols-2 gap-2 max-h-[55vh] overflow-y-auto pr-2">
                        <div class="effect-card" onclick="applyVintage('sepia')">
                            <div class="text-2xl mb-1">üü§</div>
                            <div class="vhs-font text-xs">SEPIA</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('faded')">
                            <div class="text-2xl mb-1">üå´Ô∏è</div>
                            <div class="vhs-font text-xs">FADED</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('polaroid')">
                            <div class="text-2xl mb-1">üì∑</div>
                            <div class="vhs-font text-xs">POLAROID</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('kodak')">
                            <div class="text-2xl mb-1">üéûÔ∏è</div>
                            <div class="vhs-font text-xs">KODAK</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('grain')">
                            <div class="text-2xl mb-1">‚ú®</div>
                            <div class="vhs-font text-xs">GRAIN</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('dusty')">
                            <div class="text-2xl mb-1">üí®</div>
                            <div class="vhs-font text-xs">DUSTY</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('lightleak')">
                            <div class="text-2xl mb-1">‚òÄÔ∏è</div>
                            <div class="vhs-font text-xs">LEAK</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('oldphoto')">
                            <div class="text-2xl mb-1">üñºÔ∏è</div>
                            <div class="vhs-font text-xs">OLD</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('1970s')">
                            <div class="text-2xl mb-1">üï∫</div>
                            <div class="vhs-font text-xs">1970s</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('1980s')">
                            <div class="text-2xl mb-1">üíø</div>
                            <div class="vhs-font text-xs">1980s</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('1990s')">
                            <div class="text-2xl mb-1">üíæ</div>
                            <div class="vhs-font text-xs">1990s</div>
                        </div>
                        <div class="effect-card" onclick="applyVintage('daguerreotype')">
                            <div class="text-2xl mb-1">üèõÔ∏è</div>
                            <div class="vhs-font text-xs">ANTIQUE</div>
                        </div>
                    </div>
                    
                    <!-- Frames Panel -->
                    <div id="panelFrames" class="hidden space-y-3 max-h-[55vh] overflow-y-auto pr-2">
                        <div class="grid grid-cols-2 gap-2">
                            <div class="effect-card" onclick="applyFrame('vhsFrame')">
                                <div class="text-2xl mb-1">üìº</div>
                                <div class="vhs-font text-xs">VHS</div>
                            </div>
                            <div class="effect-card" onclick="applyFrame('polaroidFrame')">
                                <div class="text-2xl mb-1">üñºÔ∏è</div>
                                <div class="vhs-font text-xs">POLAROID</div>
                            </div>
                            <div class="effect-card" onclick="applyFrame('neonBorder')">
                                <div class="text-2xl mb-1">üí†</div>
                                <div class="vhs-font text-xs">NEON</div>
                            </div>
                            <div class="effect-card" onclick="applyFrame('none')">
                                <div class="text-2xl mb-1">‚ùå</div>
                                <div class="vhs-font text-xs">NONE</div>
                            </div>
                        </div>
                        
                        <div class="tool-section p-3">
                            <h3 class="vhs-font text-sm text-pink-400 mb-3">OVERLAYS</h3>
                            <div class="space-y-1">
                                <label class="checkbox-wrapper">
                                    <input type="checkbox" id="overlayTimestamp" onchange="toggleOverlay('timestamp')">
                                    <span class="vhs-font text-sm">üìÖ TIMESTAMP</span>
                                </label>
                                <label class="checkbox-wrapper">
                                    <input type="checkbox" id="overlayRec" onchange="toggleOverlay('rec')">
                                    <span class="vhs-font text-sm">üî¥ REC</span>
                                </label>
                                <label class="checkbox-wrapper">
                                    <input type="checkbox" id="overlayPlay" onchange="toggleOverlay('play')">
                                    <span class="vhs-font text-sm">‚ñ∂ PLAY</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>
    
    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav lg:hidden">
        <button class="mobile-nav-btn" onclick="openMobilePanel('tools')">
            <span>üîß</span>
            <span>TOOLS</span>
        </button>
        <button class="mobile-nav-btn" onclick="openMobilePanel('adjust')">
            <span>üéöÔ∏è</span>
            <span>ADJUST</span>
        </button>
        <button class="mobile-nav-btn" onclick="openMobilePanel('effects')">
            <span>‚ú®</span>
            <span>EFFECTS</span>
        </button>
        <button class="mobile-nav-btn" onclick="openMobilePanel('vintage')">
            <span>üì∑</span>
            <span>VINTAGE</span>
        </button>
        <button class="mobile-nav-btn" onclick="openMobilePanel('frames')">
            <span>üñºÔ∏è</span>
            <span>FRAMES</span>
        </button>
    </nav>
    
    <!-- Mobile Panel Overlay -->
    <div class="mobile-panel-overlay lg:hidden" id="mobilePanelOverlay" onclick="closeMobilePanel()"></div>
    
    <!-- Mobile Slide-up Panel -->
    <div class="mobile-panel lg:hidden" id="mobilePanel">
        <div class="panel-handle"></div>
        <div class="mobile-panel-header">
            <h3 class="vhs-font text-lg text-cyan-400" id="mobilePanelTitle">TOOLS</h3>
            <button onclick="closeMobilePanel()" class="btn-icon w-10 h-10">‚úï</button>
        </div>
        <div class="mobile-panel-content" id="mobilePanelContent">
            <!-- Content will be dynamically inserted -->
        </div>
    </div>
    
    <script>
        // Main variables
        const canvas = document.getElementById('photoCanvas');
        const ctx = canvas.getContext('2d');
        const fileInput = document.getElementById('fileInput');
        const uploadPrompt = document.getElementById('uploadPrompt');
        const canvasContainer = document.getElementById('canvasContainer');
        
        let originalImage = null;
        let zoom = 1;
        let history = [];
        let historyIndex = -1;
        let currentTool = null;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let overlays = { timestamp: false, rec: false, play: false };
        let currentFrame = 'none';
        let activeMobilePanel = null;
        
        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
            const year = 1985 + Math.floor(Math.random() * 10);
            const text = `${months[now.getMonth()]} ${String(now.getDate()).padStart(2, '0')} ${year} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
            const el = document.getElementById('timestamp');
            if (el) el.textContent = text;
        }
        setInterval(updateTimestamp, 1000);
        updateTimestamp();
        
        // File handling
        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) loadImage(e.target.files[0]);
        });
        
        // Drag and drop
        canvasContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadPrompt.classList.add('dragover');
        });
        
        canvasContainer.addEventListener('dragleave', () => {
            uploadPrompt.classList.remove('dragover');
        });
        
        canvasContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadPrompt.classList.remove('dragover');
            if (e.dataTransfer.files[0]) loadImage(e.dataTransfer.files[0]);
        });
        
        // Click to upload on mobile
        uploadPrompt.addEventListener('click', () => {
            fileInput.click();
        });
        
        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    originalImage = img;
                    
                    // Responsive max dimensions
                    const isMobile = window.innerWidth < 768;
                    const maxWidth = isMobile ? window.innerWidth - 40 : 800;
                    const maxHeight = isMobile ? 400 : 500;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth) {
                        height = (maxWidth / width) * height;
                        width = maxWidth;
                    }
                    if (height > maxHeight) {
                        width = (maxHeight / height) * width;
                        height = maxHeight;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    canvas.classList.remove('hidden');
                    uploadPrompt.classList.add('hidden');
                    
                    document.getElementById('imageInfo').textContent = `${Math.round(width)} √ó ${Math.round(height)} px`;
                    
                    saveToHistory();
                    resetAdjustments();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // History management
        function saveToHistory() {
            historyIndex++;
            history = history.slice(0, historyIndex);
            history.push(canvas.toDataURL());
            updateHistoryButtons();
        }
        
        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                loadFromHistory();
            }
        }
        
        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                loadFromHistory();
            }
        }
        
        function loadFromHistory() {
            const img = new Image();
            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                updateHistoryButtons();
            };
            img.src = history[historyIndex];
        }
        
        function updateHistoryButtons() {
            document.getElementById('undoBtn').disabled = historyIndex <= 0;
            document.getElementById('redoBtn').disabled = historyIndex >= history.length - 1;
        }
        
        // Tab switching (desktop)
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            const tabBtn = document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`);
            if (tabBtn) tabBtn.classList.add('active');
            
            ['panelAdjust', 'panelEffects', 'panelVintage', 'panelFrames'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.add('hidden');
            });
            
            const panel = document.getElementById(`panel${tab.charAt(0).toUpperCase() + tab.slice(1)}`);
            if (panel) panel.classList.remove('hidden');
        }
        
        // Mobile Panel Functions
        function openMobilePanel(type) {
            activeMobilePanel = type;
            const overlay = document.getElementById('mobilePanelOverlay');
            const panel = document.getElementById('mobilePanel');
            const title = document.getElementById('mobilePanelTitle');
            const content = document.getElementById('mobilePanelContent');
            
            // Update nav buttons
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // Set title
            const titles = {
                tools: 'üîß TOOLS',
                adjust: 'üéöÔ∏è ADJUSTMENTS',
                effects: '‚ú® EFFECTS',
                vintage: 'üì∑ VINTAGE',
                frames: 'üñºÔ∏è FRAMES'
            };
            title.textContent = titles[type] || type.toUpperCase();
            
            // Set content
            content.innerHTML = getMobilePanelContent(type);
            
            // Bind events for sliders
            if (type === 'adjust') {
                bindMobileSliders();
            }
            
            overlay.classList.add('active');
            panel.classList.add('active');
        }
        
        function closeMobilePanel() {
            document.getElementById('mobilePanelOverlay').classList.remove('active');
            document.getElementById('mobilePanel').classList.remove('active');
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => btn.classList.remove('active'));
            activeMobilePanel = null;
        }
        
        function getMobilePanelContent(type) {
            switch(type) {
                case 'tools':
                    return `
                        <div class="space-y-4">
                            <div class="tool-section p-4">
                                <h3 class="vhs-font text-sm text-pink-400 mb-3">TRANSFORM</h3>
                                <div class="grid grid-cols-4 gap-3">
                                    <button onclick="rotateImage(-90)" class="btn-icon">‚Ü∫</button>
                                    <button onclick="rotateImage(90)" class="btn-icon">‚Üª</button>
                                    <button onclick="flipImage('h')" class="btn-icon">‚áÜ</button>
                                    <button onclick="flipImage('v')" class="btn-icon">‚áÖ</button>
                                </div>
                            </div>
                            <div class="tool-section p-4">
                                <h3 class="vhs-font text-sm text-pink-400 mb-3">DRAW</h3>
                                <div class="flex items-center gap-3 mb-3">
                                    <button onclick="setTool('brush'); updateMobileToolButtons()" class="btn-icon flex-1 ${currentTool === 'brush' ? 'active' : ''}" id="mobileBrushTool">üñåÔ∏è Brush</button>
                                    <button onclick="setTool('eraser'); updateMobileToolButtons()" class="btn-icon flex-1 ${currentTool === 'eraser' ? 'active' : ''}" id="mobileEraserTool">üßπ Eraser</button>
                                </div>
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="color-picker-wrapper">
                                        <input type="color" id="mobileBrushColor" value="${document.getElementById('brushColor')?.value || '#ff2a6d'}" onchange="document.getElementById('brushColor').value = this.value">
                                    </div>
                                    <div class="flex-1 slider-wrapper">
                                        <label class="vhs-font text-xs text-gray-400">SIZE</label>
                                        <input type="range" id="mobileBrushSize" min="1" max="50" value="${document.getElementById('brushSize')?.value || 5}" onchange="document.getElementById('brushSize').value = this.value">
                                    </div>
                                </div>
                            </div>
                            <div class="tool-section p-4">
                                <h3 class="vhs-font text-sm text-pink-400 mb-3">ADD TEXT</h3>
                                <input type="text" id="mobileTextInput" placeholder="Enter text..." 
                                    class="w-full bg-black/50 border border-cyan-500/30 rounded px-3 py-3 text-base mb-3 focus:border-pink-500 focus:outline-none">
                                <div class="flex gap-2 mb-3">
                                    <select id="mobileTextFont" class="flex-1 bg-black/50 border border-cyan-500/30 rounded px-3 py-3 text-sm">
                                        <option value="VT323">VHS</option>
                                        <option value="Orbitron">RETRO</option>
                                        <option value="Press Start 2P">PIXEL</option>
                                    </select>
                                    <input type="number" id="mobileTextSize" value="32" min="8" max="120" 
                                        class="w-20 bg-black/50 border border-cyan-500/30 rounded px-3 py-3 text-sm">
                                </div>
                                <button onclick="addTextMobile()" class="btn-neon w-full">ADD TEXT</button>
                            </div>
                        </div>
                    `;
                    
                case 'adjust':
                    return `
                        <div class="space-y-5">
                            ${['brightness', 'contrast', 'saturation', 'exposure', 'temperature', 'tint', 'vignette', 'blur', 'hue'].map(adj => `
                                <div class="slider-wrapper">
                                    <div class="flex justify-between mb-2">
                                        <label class="vhs-font text-sm text-pink-400">${adj.toUpperCase()}</label>
                                        <span class="vhs-font text-xs text-cyan-400" id="mobile${adj}Val">${document.getElementById(adj)?.value || 0}${adj === 'hue' ? '¬∞' : ''}</span>
                                    </div>
                                    <input type="range" id="mobile${adj}" 
                                        min="${adj === 'vignette' || adj === 'blur' ? 0 : adj === 'hue' ? 0 : -100}" 
                                        max="${adj === 'hue' ? 360 : adj === 'blur' ? 20 : 100}" 
                                        value="${document.getElementById(adj)?.value || 0}"
                                        step="${adj === 'blur' ? 0.5 : 1}"
                                        oninput="syncSlider('${adj}', this.value)">
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                case 'effects':
                    return `
                        <div class="grid grid-cols-3 gap-3">
                            ${[
                                ['vhs', 'üìº', 'VHS'],
                                ['glitch', 'üëæ', 'GLITCH'],
                                ['scanlines', 'üì∫', 'SCAN'],
                                ['chromatic', 'üåà', 'RGB'],
                                ['pixelate', 'üéÆ', '8-BIT'],
                                ['neon', 'üíú', 'NEON'],
                                ['cyberpunk', 'üåÉ', 'CYBER'],
                                ['synthwave', 'üåÖ', 'SYNTH'],
                                ['vaporwave', 'üå¥', 'VAPOR'],
                                ['miami', 'üèñÔ∏è', 'MIAMI'],
                                ['tokyo', 'üóº', 'TOKYO'],
                                ['duotone', 'üé®', 'DUO']
                            ].map(([id, icon, label]) => `
                                <div class="effect-card" onclick="applyEffect('${id}')">
                                    <div class="text-2xl mb-1">${icon}</div>
                                    <div class="vhs-font text-xs">${label}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                case 'vintage':
                    return `
                        <div class="grid grid-cols-3 gap-3">
                            ${[
                                ['sepia', 'üü§', 'SEPIA'],
                                ['faded', 'üå´Ô∏è', 'FADED'],
                                ['polaroid', 'üì∑', 'POLAROID'],
                                ['kodak', 'üéûÔ∏è', 'KODAK'],
                                ['grain', '‚ú®', 'GRAIN'],
                                ['dusty', 'üí®', 'DUSTY'],
                                ['lightleak', '‚òÄÔ∏è', 'LEAK'],
                                ['oldphoto', 'üñºÔ∏è', 'OLD'],
                                ['1970s', 'üï∫', '1970s'],
                                ['1980s', 'üíø', '1980s'],
                                ['1990s', 'üíæ', '1990s'],
                                ['daguerreotype', 'üèõÔ∏è', 'ANTIQUE']
                            ].map(([id, icon, label]) => `
                                <div class="effect-card" onclick="applyVintage('${id}')">
                                    <div class="text-2xl mb-1">${icon}</div>
                                    <div class="vhs-font text-xs">${label}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                case 'frames':
                    return `
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-3">
                                <div class="effect-card" onclick="applyFrame('vhsFrame')">
                                    <div class="text-2xl mb-1">üìº</div>
                                    <div class="vhs-font text-xs">VHS FRAME</div>
                                </div>
                                <div class="effect-card" onclick="applyFrame('polaroidFrame')">
                                    <div class="text-2xl mb-1">üñºÔ∏è</div>
                                    <div class="vhs-font text-xs">POLAROID</div>
                                </div>
                                <div class="effect-card" onclick="applyFrame('neonBorder')">
                                    <div class="text-2xl mb-1">üí†</div>
                                    <div class="vhs-font text-xs">NEON</div>
                                </div>
                                <div class="effect-card" onclick="applyFrame('none')">
                                    <div class="text-2xl mb-1">‚ùå</div>
                                    <div class="vhs-font text-xs">NO FRAME</div>
                                </div>
                            </div>
                            <div class="tool-section p-4">
                                <h3 class="vhs-font text-sm text-pink-400 mb-3">OVERLAYS</h3>
                                <div class="space-y-2">
                                    <label class="checkbox-wrapper">
                                        <input type="checkbox" id="mobileOverlayTimestamp" ${overlays.timestamp ? 'checked' : ''} onchange="toggleOverlay('timestamp')">
                                        <span class="vhs-font text-sm">üìÖ TIMESTAMP</span>
                                    </label>
                                    <label class="checkbox-wrapper">
                                        <input type="checkbox" id="mobileOverlayRec" ${overlays.rec ? 'checked' : ''} onchange="toggleOverlay('rec')">
                                        <span class="vhs-font text-sm">üî¥ REC</span>
                                    </label>
                                    <label class="checkbox-wrapper">
                                        <input type="checkbox" id="mobileOverlayPlay" ${overlays.play ? 'checked' : ''} onchange="toggleOverlay('play')">
                                        <span class="vhs-font text-sm">‚ñ∂ PLAY</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    `;
                    
                default:
                    return '';
            }
        }
        
        function syncSlider(name, value) {
            const desktopSlider = document.getElementById(name);
            if (desktopSlider) desktopSlider.value = value;
            
            const valDisplay = document.getElementById(`mobile${name}Val`);
            if (valDisplay) valDisplay.textContent = value + (name === 'hue' ? '¬∞' : '');
            
            updateAdjustments();
        }
        
        function bindMobileSliders() {
            // Sliders are already bound via oninput in HTML
        }
        
        function updateMobileToolButtons() {
            const brushBtn = document.getElementById('mobileBrushTool');
            const eraserBtn = document.getElementById('mobileEraserTool');
            if (brushBtn) brushBtn.classList.toggle('active', currentTool === 'brush');
            if (eraserBtn) eraserBtn.classList.toggle('active', currentTool === 'eraser');
        }
        
        function addTextMobile() {
            const text = document.getElementById('mobileTextInput')?.value;
            const font = document.getElementById('mobileTextFont')?.value || 'VT323';
            const size = document.getElementById('mobileTextSize')?.value || 32;
            const color = document.getElementById('mobileBrushColor')?.value || '#ff2a6d';
            
            if (!text || !originalImage) return;
            
            ctx.font = `${size}px ${font}, monospace`;
            ctx.fillStyle = color;
            ctx.shadowColor = color;
            ctx.shadowBlur = 10;
            ctx.fillText(text, canvas.width / 2 - ctx.measureText(text).width / 2, canvas.height / 2);
            ctx.shadowBlur = 0;
            
            saveToHistory();
        }
        
        // Adjustments
        function updateAdjustments() {
            if (!originalImage) return;
            
            const getValue = (id) => parseFloat(document.getElementById(id)?.value || 0);
            
            const brightness = getValue('brightness');
            const contrast = getValue('contrast');
            const saturation = getValue('saturation');
            const exposure = getValue('exposure');
            const hue = getValue('hue');
            const blur = getValue('blur');
            const vignette = getValue('vignette');
            const temperature = getValue('temperature');
            const tint = getValue('tint');
            
            // Update desktop value displays
            const updateVal = (id, val, suffix = '') => {
                const el = document.getElementById(id);
                if (el) el.textContent = val + suffix;
            };
            
            updateVal('brightnessVal', brightness);
            updateVal('contrastVal', contrast);
            updateVal('saturationVal', saturation);
            updateVal('exposureVal', exposure);
            updateVal('temperatureVal', temperature);
            updateVal('tintVal', tint);
            updateVal('vignetteVal', vignette);
            updateVal('blurVal', blur);
            updateVal('hueVal', hue, '¬∞');
            
            // Apply CSS filters
            const brightnessFilter = (brightness + 100) / 100;
            const contrastFilter = (contrast + 100) / 100;
            const saturationFilter = (saturation + 100) / 100;
            const exposureFilter = 1 + (exposure / 100);
            
            ctx.filter = `brightness(${brightnessFilter * exposureFilter}) contrast(${contrastFilter}) saturate(${saturationFilter}) hue-rotate(${hue}deg) blur(${blur}px)`;
            ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
            ctx.filter = 'none';
            
            // Apply temperature/tint
            if (temperature !== 0 || tint !== 0) {
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                for (let i = 0; i < data.length; i += 4) {
                    data[i] = Math.min(255, Math.max(0, data[i] + temperature * 0.5));
                    data[i + 2] = Math.min(255, Math.max(0, data[i + 2] - temperature * 0.5));
                    data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + tint * 0.3));
                }
                ctx.putImageData(imageData, 0, 0);
            }
            
            // Apply vignette
            if (vignette > 0) {
                const gradient = ctx.createRadialGradient(
                    canvas.width / 2, canvas.height / 2, canvas.width * 0.2,
                    canvas.width / 2, canvas.height / 2, canvas.width * 0.7
                );
                gradient.addColorStop(0, 'rgba(0,0,0,0)');
                gradient.addColorStop(1, `rgba(0,0,0,${vignette / 100})`);
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            renderOverlays();
        }
        
        function resetAdjustments() {
            ['brightness', 'contrast', 'saturation', 'exposure', 'temperature', 'tint', 'vignette', 'blur', 'hue'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = 0;
            });
            updateAdjustments();
        }
        
        function resetImage() {
            if (originalImage) {
                resetAdjustments();
                ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
                currentFrame = 'none';
                overlays = { timestamp: false, rec: false, play: false };
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                saveToHistory();
            }
        }
        
        // Effects (same as before, condensed)
        function applyEffect(effect) {
            if (!originalImage) return;
            updateAdjustments();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            const effects = {
                vhs: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        const noise = (Math.random() - 0.5) * 25;
                        data[i] = Math.min(255, Math.max(0, data[i] + noise + 15));
                        data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + noise));
                        data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + noise + 25));
                    }
                },
                glitch: () => {
                    const temp = new Uint8ClampedArray(data);
                    for (let y = 0; y < canvas.height; y++) {
                        if (Math.random() > 0.92) {
                            const offset = Math.floor((Math.random() - 0.5) * 60);
                            for (let x = 0; x < canvas.width; x++) {
                                const srcX = Math.min(canvas.width - 1, Math.max(0, x + offset));
                                const srcIdx = (y * canvas.width + srcX) * 4;
                                const dstIdx = (y * canvas.width + x) * 4;
                                data[dstIdx] = temp[srcIdx];
                                data[dstIdx + 1] = temp[srcIdx + 1];
                                data[dstIdx + 2] = temp[srcIdx + 2];
                            }
                        }
                    }
                },
                scanlines: () => {
                    for (let y = 0; y < canvas.height; y += 2) {
                        for (let x = 0; x < canvas.width; x++) {
                            const idx = (y * canvas.width + x) * 4;
                            data[idx] *= 0.7;
                            data[idx + 1] *= 0.7;
                            data[idx + 2] *= 0.7;
                        }
                    }
                },
                chromatic: () => {
                    const temp = new Uint8ClampedArray(data);
                    for (let y = 0; y < canvas.height; y++) {
                        for (let x = 0; x < canvas.width; x++) {
                            const idx = (y * canvas.width + x) * 4;
                            const rIdx = (y * canvas.width + Math.min(canvas.width - 1, x + 6)) * 4;
                            const bIdx = (y * canvas.width + Math.max(0, x - 6)) * 4;
                            data[idx] = temp[rIdx];
                            data[idx + 2] = temp[bIdx];
                        }
                    }
                },
                pixelate: () => {
                    const size = 6;
                    for (let y = 0; y < canvas.height; y += size) {
                        for (let x = 0; x < canvas.width; x += size) {
                            const idx = (y * canvas.width + x) * 4;
                            const r = data[idx], g = data[idx + 1], b = data[idx + 2];
                            for (let py = 0; py < size && y + py < canvas.height; py++) {
                                for (let px = 0; px < size && x + px < canvas.width; px++) {
                                    const pIdx = ((y + py) * canvas.width + (x + px)) * 4;
                                    data[pIdx] = r; data[pIdx + 1] = g; data[pIdx + 2] = b;
                                }
                            }
                        }
                    }
                },
                neon: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        if ((data[i] + data[i + 1] + data[i + 2]) / 3 > 100) {
                            data[i] = Math.min(255, data[i] * 1.4);
                            data[i + 2] = Math.min(255, data[i + 2] * 1.5);
                        }
                        data[i + 1] *= 0.6;
                    }
                },
                cyberpunk: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 0.8 + 40);
                        data[i + 1] *= 0.9;
                        data[i + 2] = Math.min(255, data[i + 2] * 1.3);
                    }
                },
                synthwave: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        const y = Math.floor((i / 4) / canvas.width) / canvas.height;
                        data[i] = Math.min(255, data[i] * (1.2 + y * 0.3));
                        data[i + 1] *= (0.6 + y * 0.2);
                        data[i + 2] = Math.min(255, data[i + 2] * (1.4 - y * 0.3));
                    }
                },
                vaporwave: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 0.9 + 60);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.1 + 40);
                        data[i + 2] = Math.min(255, data[i + 2] * 1.2 + 70);
                    }
                },
                miami: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.3 + 30);
                        data[i + 1] *= 0.85;
                        data[i + 2] = Math.min(255, data[i + 2] * 1.2 + 50);
                    }
                },
                tokyo: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.1 + 20);
                        data[i + 1] *= 0.7;
                        data[i + 2] = Math.min(255, data[i + 2] * 1.5);
                    }
                },
                duotone: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        const gray = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        data[i] = Math.min(255, gray * 1.5);
                        data[i + 1] = gray * 0.2;
                        data[i + 2] = Math.min(255, gray * 1.8);
                    }
                }
            };
            
            if (effects[effect]) effects[effect]();
            ctx.putImageData(imageData, 0, 0);
            renderOverlays();
            saveToHistory();
        }
        
        // Vintage effects
        function applyVintage(effect) {
            if (!originalImage) return;
            updateAdjustments();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            const effects = {
                sepia: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i], g = data[i + 1], b = data[i + 2];
                        data[i] = Math.min(255, r * 0.393 + g * 0.769 + b * 0.189);
                        data[i + 1] = Math.min(255, r * 0.349 + g * 0.686 + b * 0.168);
                        data[i + 2] = Math.min(255, r * 0.272 + g * 0.534 + b * 0.131);
                    }
                },
                faded: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 0.9 + 25);
                        data[i + 1] = Math.min(255, data[i + 1] * 0.85 + 20);
                        data[i + 2] = Math.min(255, data[i + 2] * 0.8 + 30);
                    }
                },
                polaroid: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.1 + 10);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.05 + 10);
                        data[i + 2] = data[i + 2] * 0.9 + 20;
                    }
                },
                kodak: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.15 + 15);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.05 + 5);
                        data[i + 2] = data[i + 2] * 0.85;
                    }
                },
                grain: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        const grain = (Math.random() - 0.5) * 40;
                        data[i] = Math.min(255, Math.max(0, data[i] + grain));
                        data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + grain));
                        data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + grain));
                    }
                },
                dusty: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        if (Math.random() > 0.995) data[i] = data[i + 1] = data[i + 2] = 255;
                        const grain = (Math.random() - 0.5) * 20;
                        data[i] = Math.min(255, Math.max(0, data[i] + grain + 10));
                        data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + grain + 5));
                        data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + grain));
                    }
                },
                lightleak: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        const x = (i / 4) % canvas.width;
                        const y = Math.floor((i / 4) / canvas.width);
                        const dist = Math.sqrt(Math.pow(x - canvas.width * 0.8, 2) + Math.pow(y - canvas.height * 0.2, 2));
                        const maxDist = Math.sqrt(Math.pow(canvas.width, 2) + Math.pow(canvas.height, 2)) * 0.5;
                        const intensity = Math.max(0, 1 - dist / maxDist) * 100;
                        data[i] = Math.min(255, data[i] + intensity * 1.5);
                        data[i + 1] = Math.min(255, data[i + 1] + intensity * 0.8);
                    }
                },
                oldphoto: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        const gray = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        const grain = (Math.random() - 0.5) * 30;
                        data[i] = Math.min(255, gray * 1.1 + 30 + grain);
                        data[i + 1] = Math.min(255, gray * 0.9 + 15 + grain);
                        data[i + 2] = Math.min(255, gray * 0.7 + grain);
                    }
                },
                '1970s': () => {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.1 + 20);
                        data[i + 1] = Math.min(255, data[i + 1] * 0.95 + 10);
                        data[i + 2] = data[i + 2] * 0.8;
                    }
                },
                '1980s': () => {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.2 + 15);
                        data[i + 1] = data[i + 1] * 0.85;
                        data[i + 2] = Math.min(255, data[i + 2] * 1.3 + 20);
                    }
                },
                '1990s': () => {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.05 + 5);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.1);
                        data[i + 2] = Math.min(255, data[i + 2] * 1.15 + 10);
                    }
                },
                daguerreotype: () => {
                    for (let i = 0; i < data.length; i += 4) {
                        const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
                        const contrast = ((gray - 128) * 1.3) + 128;
                        data[i] = Math.min(255, contrast + 20);
                        data[i + 1] = Math.min(255, contrast + 10);
                        data[i + 2] = contrast;
                    }
                }
            };
            
            if (effects[effect]) effects[effect]();
            ctx.putImageData(imageData, 0, 0);
            renderOverlays();
            saveToHistory();
        }
        
        // Frames & Overlays
        function applyFrame(frame) {
            currentFrame = frame;
            updateAdjustments();
            saveToHistory();
        }
        
        function toggleOverlay(overlay) {
            overlays[overlay] = !overlays[overlay];
            updateAdjustments();
        }
        
        function renderOverlays() {
            if (currentFrame === 'vhsFrame') {
                const topGrad = ctx.createLinearGradient(0, 0, 0, 50);
                topGrad.addColorStop(0, 'rgba(0,0,0,0.7)');
                topGrad.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = topGrad;
                ctx.fillRect(0, 0, canvas.width, 50);
                
                const bottomGrad = ctx.createLinearGradient(0, canvas.height - 50, 0, canvas.height);
                bottomGrad.addColorStop(0, 'rgba(0,0,0,0)');
                bottomGrad.addColorStop(1, 'rgba(0,0,0,0.7)');
                ctx.fillStyle = bottomGrad;
                ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
            }
            
            if (currentFrame === 'polaroidFrame') {
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 15;
                ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
            }
            
            if (currentFrame === 'neonBorder') {
                ctx.strokeStyle = '#ff2a6d';
                ctx.lineWidth = 4;
                ctx.shadowColor = '#ff2a6d';
                ctx.shadowBlur = 15;
                ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
                ctx.strokeStyle = '#05d9e8';
                ctx.strokeRect(15, 15, canvas.width - 30, canvas.height - 30);
                ctx.shadowBlur = 0;
            }
            
            if (overlays.timestamp) {
                const now = new Date();
                const year = 1985 + Math.floor(Math.random() * 10);
                ctx.fillStyle = '#ffcc00';
                ctx.font = 'bold 20px VT323, monospace';
                ctx.shadowColor = '#000';
                ctx.shadowBlur = 4;
                ctx.fillText(`${now.getMonth() + 1}/${now.getDate()}/${year}`, canvas.width - 120, canvas.height - 15);
                ctx.shadowBlur = 0;
            }
            
            if (overlays.rec) {
                ctx.fillStyle = '#ff0000';
                ctx.beginPath();
                ctx.arc(25, 25, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 16px VT323, monospace';
                ctx.fillText('REC', 38, 30);
            }
            
            if (overlays.play) {
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 18px VT323, monospace';
                ctx.fillText('‚ñ∂ PLAY', 15, canvas.height - 15);
            }
        }
        
        // Transform functions
        function rotateImage(degrees) {
            if (!originalImage) return;
            
            const temp = document.createElement('canvas');
            const tempCtx = temp.getContext('2d');
            
            if (Math.abs(degrees) === 90) {
                temp.width = canvas.height;
                temp.height = canvas.width;
            } else {
                temp.width = canvas.width;
                temp.height = canvas.height;
            }
            
            tempCtx.translate(temp.width / 2, temp.height / 2);
            tempCtx.rotate(degrees * Math.PI / 180);
            tempCtx.drawImage(canvas, -canvas.width / 2, -canvas.height / 2);
            
            canvas.width = temp.width;
            canvas.height = temp.height;
            ctx.drawImage(temp, 0, 0);
            
            const newImg = new Image();
            newImg.onload = () => { originalImage = newImg; };
            newImg.src = canvas.toDataURL();
            
            saveToHistory();
        }
        
        function flipImage(direction) {
            if (!originalImage) return;
            
            const temp = document.createElement('canvas');
            const tempCtx = temp.getContext('2d');
            temp.width = canvas.width;
            temp.height = canvas.height;
            
            if (direction === 'h') {
                tempCtx.translate(canvas.width, 0);
                tempCtx.scale(-1, 1);
            } else {
                tempCtx.translate(0, canvas.height);
                tempCtx.scale(1, -1);
            }
            
            tempCtx.drawImage(canvas, 0, 0);
            ctx.drawImage(temp, 0, 0);
            
            const newImg = new Image();
            newImg.onload = () => { originalImage = newImg; };
            newImg.src = canvas.toDataURL();
            
            saveToHistory();
        }
        
        // Zoom
        function zoomCanvas(delta) {
            zoom = Math.max(0.25, Math.min(3, zoom + delta));
            canvas.style.transform = `scale(${zoom})`;
            document.getElementById('zoomLevel').textContent = Math.round(zoom * 100) + '%';
        }
        
        function resetZoom() {
            zoom = 1;
            canvas.style.transform = 'scale(1)';
            document.getElementById('zoomLevel').textContent = '100%';
        }
        
        // Drawing tools with touch support
        function setTool(tool) {
            currentTool = currentTool === tool ? null : tool;
            const brushBtn = document.getElementById('brushTool');
            const eraserBtn = document.getElementById('eraserTool');
            if (brushBtn) brushBtn.classList.toggle('active', currentTool === 'brush');
            if (eraserBtn) eraserBtn.classList.toggle('active', currentTool === 'eraser');
            canvas.style.cursor = currentTool ? 'crosshair' : 'default';
        }
        
        // Mouse events
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        
        // Touch events
        canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
        canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
        canvas.addEventListener('touchend', stopDrawing);
        
        function handleTouchStart(e) {
            if (!currentTool) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            isDrawing = true;
            lastX = (touch.clientX - rect.left) * (canvas.width / rect.width);
            lastY = (touch.clientY - rect.top) * (canvas.height / rect.height);
        }
        
        function handleTouchMove(e) {
            if (!isDrawing || !currentTool) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
            const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : (document.getElementById('brushColor')?.value || '#ff2a6d');
            ctx.lineWidth = document.getElementById('brushSize')?.value || 5;
            ctx.lineCap = 'round';
            ctx.stroke();
            
            lastX = x;
            lastY = y;
        }
        
        function startDrawing(e) {
            if (!currentTool) return;
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            lastX = (e.clientX - rect.left) * (canvas.width / rect.width);
            lastY = (e.clientY - rect.top) * (canvas.height / rect.height);
        }
        
        function draw(e) {
            if (!isDrawing || !currentTool) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (canvas.width / rect.width);
            const y = (e.clientY - rect.top) * (canvas.height / rect.height);
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : (document.getElementById('brushColor')?.value || '#ff2a6d');
            ctx.lineWidth = document.getElementById('brushSize')?.value || 5;
            ctx.lineCap = 'round';
            ctx.stroke();
            
            lastX = x;
            lastY = y;
        }
        
        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                saveToHistory();
            }
        }
        
        // Text tool
        function addText() {
            if (!originalImage) return;
            
            const text = document.getElementById('textInput')?.value;
            if (!text) return;
            
            const font = document.getElementById('textFont')?.value || 'VT323';
            const size = document.getElementById('textSize')?.value || 32;
            const color = document.getElementById('brushColor')?.value || '#ff2a6d';
            
            ctx.font = `${size}px ${font}, monospace`;
            ctx.fillStyle = color;
            ctx.shadowColor = color;
            ctx.shadowBlur = 10;
            ctx.fillText(text, canvas.width / 2 - ctx.measureText(text).width / 2, canvas.height / 2);
            ctx.shadowBlur = 0;
            
            saveToHistory();
        }
        
        // Download
        function downloadImage(format = 'png') {
            if (!originalImage) return;
            
            const link = document.createElement('a');
            const timestamp = new Date().getTime();
            link.download = `neon_memories_${timestamp}.${format}`;
            link.href = canvas.toDataURL(`image/${format === 'jpg' ? 'jpeg' : 'png'}`, 0.9);
            link.click();
        }
        
        // Handle resize
        window.addEventListener('resize', () => {
            if (activeMobilePanel && window.innerWidth >= 1024) {
                closeMobilePanel();
            }
        });
    </script>
</body>
</html>